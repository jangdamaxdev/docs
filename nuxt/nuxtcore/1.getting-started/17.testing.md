---
title: Testing
description: C√°ch test ·ª©ng d·ª•ng Nuxt c·ªßa b·∫°n.
navigation.icon: i-lucide-circle-check
---

::tip
N·∫øu b·∫°n l√† m·ªôt module author, b·∫°n c√≥ th·ªÉ t√¨m th√¥ng tin c·ª• th·ªÉ h∆°n trong [Module Author's guide](/docs/guide/going-further/modules#testing).
::

Nuxt cung c·∫•p h·ªó tr·ª£ first-class cho end-to-end v√† unit testing c·ªßa ·ª©ng d·ª•ng Nuxt th√¥ng qua `@nuxt/test-utils`, m·ªôt th∆∞ vi·ªán c√°c utility v√† c·∫•u h√¨nh test hi·ªán ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng trong [c√°c test m√† ch√∫ng t√¥i s·ª≠ d·ª•ng tr√™n ch√≠nh Nuxt](https://github.com/nuxt/nuxt/tree/main/test) v√† c√°c test trong to√†n b·ªô h·ªá sinh th√°i module.

:video-accordion{title="Xem video t·ª´ Alexander Lichter v·ªÅ vi·ªác b·∫Øt ƒë·∫ßu v·ªõi @nuxt/test-utils" videoId="yGzwk9xi9gU"}

## Installation

ƒê·ªÉ cho ph√©p b·∫°n qu·∫£n l√Ω c√°c dependency testing kh√°c, `@nuxt/test-utils` ƒëi k√®m v·ªõi c√°c optional peer dependency kh√°c nhau. V√≠ d·ª•:

- b·∫°n c√≥ th·ªÉ ch·ªçn gi·ªØa `happy-dom` v√† `jsdom` cho runtime Nuxt environment
- b·∫°n c√≥ th·ªÉ ch·ªçn gi·ªØa `vitest`, `cucumber`, `jest` v√† `playwright` cho end-to-end test runner
- `playwright-core` ch·ªâ c·∫ßn thi·∫øt n·∫øu b·∫°n mu·ªën s·ª≠ d·ª•ng built-in browser testing utility (v√† kh√¥ng s·ª≠ d·ª•ng `@playwright/test` l√†m test runner)

::code-group{sync="pm"}
```bash [npm]
npm i --save-dev @nuxt/test-utils vitest @vue/test-utils happy-dom playwright-core
```
```bash [yarn]
yarn add --dev @nuxt/test-utils vitest @vue/test-utils happy-dom playwright-core
```
```bash [pnpm]
pnpm add -D @nuxt/test-utils vitest @vue/test-utils happy-dom playwright-core
```
```bash [bun]
bun add --dev @nuxt/test-utils vitest @vue/test-utils happy-dom playwright-core
```
::

## Unit Testing

Hi·ªán t·∫°i ch√∫ng t√¥i cung c·∫•p m·ªôt environment cho unit testing code c·∫ßn [Nuxt](https://nuxt.com) runtime environment. Hi·ªán t·∫°i n√≥ _ch·ªâ h·ªó tr·ª£ `vitest`_ (m·∫∑c d√π contribution ƒë·ªÉ th√™m c√°c runtime kh√°c s·∫Ω ƒë∆∞·ª£c ch√†o ƒë√≥n).

### Setup

1. Th√™m `@nuxt/test-utils/module` v√†o file `nuxt.config` c·ªßa b·∫°n (t√πy ch·ªçn). N√≥ th√™m t√≠ch h·ª£p Vitest v√†o Nuxt DevTools c·ªßa b·∫°n ƒë·ªÉ h·ªó tr·ª£ ch·∫°y unit test trong development.

   ```ts twoslash
   export default defineNuxtConfig({
     modules: [
       '@nuxt/test-utils/module'
     ]
   })
   ```

2. T·∫°o file `vitest.config.ts` v·ªõi n·ªôi dung sau:

   ```ts twoslash
   import { defineConfig } from 'vitest/config'
   import { defineVitestProject } from '@nuxt/test-utils/config'

   export default defineConfig({
     test: {
       projects: [
         {
           test: {
             name: 'unit',
             include: ['test/{e2e,unit}/*.{test,spec}.ts'],
             environment: 'node',
           },
         },
         await defineVitestProject({
           test: {
             name: 'nuxt',
             include: ['test/nuxt/*.{test,spec}.ts'],
             environment: 'nuxt',
           },
         }),
       ],
     },
   })
   ```

::tip
Khi import `@nuxt/test-utils` trong vitest config c·ªßa b·∫°n, c·∫ßn thi·∫øt ph·∫£i c√≥ `"type": "module"` ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh trong `package.json` ho·∫∑c ƒë·ªïi t√™n file vitest config m·ªôt c√°ch th√≠ch h·ª£p.
> t·ª©c l√†, `vitest.config.m{ts,js}`.
::

::tip
C√≥ th·ªÉ ƒë·∫∑t bi·∫øn m√¥i tr∆∞·ªùng cho testing b·∫±ng c√°ch s·ª≠ d·ª•ng file `.env.test`.
::

### Using a Nuxt Runtime Environment

S·ª≠ d·ª•ng [Vitest projects](https://vitest.dev/guide/projects.html#test-projects), b·∫°n c√≥ ki·ªÉm so√°t chi ti·∫øt v·ªÅ test n√†o ch·∫°y trong environment n√†o:

- **Unit tests**: ƒê·∫∑t c√°c regular unit test trong `test/unit/` - nh·ªØng test n√†y ch·∫°y trong Node environment ƒë·ªÉ c√≥ t·ªëc ƒë·ªô
- **Nuxt tests**: ƒê·∫∑t c√°c test d·ª±a v√†o Nuxt runtime environment trong `test/nuxt/` - nh·ªØng test n√†y s·∫Ω ch·∫°y trong Nuxt runtime environment

#### Alternative: Simple Setup

N·∫øu b·∫°n th√≠ch thi·∫øt l·∫≠p ƒë∆°n gi·∫£n h∆°n v√† mu·ªën t·∫•t c·∫£ test ch·∫°y trong Nuxt environment, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng c·∫•u h√¨nh c∆° b·∫£n:

```ts twoslash
import { defineVitestConfig } from '@nuxt/test-utils/config'

export default defineVitestConfig({
  test: {
    environment: 'nuxt',
    // b·∫°n c√≥ th·ªÉ t√πy ch·ªçn ƒë·∫∑t c√°c t√πy ch·ªçn environment c·ª• th·ªÉ c·ªßa Nuxt
    // environmentOptions: {
    //   nuxt: {
    //     rootDir: fileURLToPath(new URL('./playground', import.meta.url)),
    //     domEnvironment: 'happy-dom', // 'happy-dom' (m·∫∑c ƒë·ªãnh) ho·∫∑c 'jsdom'
    //     overrides: {
    //       // c·∫•u h√¨nh Nuxt kh√°c b·∫°n mu·ªën truy·ªÅn
    //     }
    //   }
    // }
  }
})
```

N·∫øu b·∫°n ƒëang s·ª≠ d·ª•ng simple setup v·ªõi `environment: 'nuxt'` theo m·∫∑c ƒë·ªãnh, b·∫°n c√≥ th·ªÉ opt _out_ kh·ªèi [Nuxt environment](https://vitest.dev/guide/environment.html#test-environment) cho t·ª´ng test file khi c·∫ßn.

```ts twoslash
// @vitest-environment node
import { test } from 'vitest'

test('my test', () => {
  // ... test kh√¥ng c√≥ Nuxt environment!
})
```

::warning
C√°ch ti·∫øp c·∫≠n n√†y kh√¥ng ƒë∆∞·ª£c khuy·∫øn ngh·ªã v√¨ n√≥ t·∫°o ra m·ªôt hybrid environment n∆°i Nuxt Vite plugin ch·∫°y nh∆∞ng Nuxt entry v√† `nuxtApp` kh√¥ng ƒë∆∞·ª£c kh·ªüi t·∫°o. ƒêi·ªÅu n√†y c√≥ th·ªÉ d·∫´n ƒë·∫øn c√°c l·ªói kh√≥ debug.
::

### Organizing Your Tests

V·ªõi thi·∫øt l·∫≠p d·ª±a tr√™n project, b·∫°n c√≥ th·ªÉ t·ªï ch·ª©c test nh∆∞ sau:

```bash [Directory structure]
test/
‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îî‚îÄ‚îÄ ssr.test.ts
‚îú‚îÄ‚îÄ nuxt/
‚îÇ   ‚îú‚îÄ‚îÄ components.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ composables.test.ts
‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îî‚îÄ‚îÄ utils.test.ts
```

B·∫°n c√≥ th·ªÉ t√πy ch·ªçn b·∫•t k·ª≥ c·∫•u tr√∫c test n√†o, nh∆∞ng vi·ªác gi·ªØ Nuxt runtime environment t√°ch bi·ªát kh·ªèi Nuxt end-to-end test l√† quan tr·ªçng cho t√≠nh ·ªïn ƒë·ªãnh c·ªßa test.

#### Running Tests

V·ªõi project setup, b·∫°n c√≥ th·ªÉ ch·∫°y c√°c test suite kh√°c nhau:

```bash
# Ch·∫°y t·∫•t c·∫£ test
npx vitest

# Ch·ªâ ch·∫°y unit test
npx vitest --project unit

# Ch·ªâ ch·∫°y Nuxt test
npx vitest --project nuxt

# Ch·∫°y test trong watch mode
npx vitest --watch
```

::warning
Khi b·∫°n ch·∫°y test trong Nuxt environment, ch√∫ng s·∫Ω ch·∫°y trong m√¥i tr∆∞·ªùng [`happy-dom`](https://github.com/capricorn86/happy-dom) ho·∫∑c [`jsdom`](https://github.com/jsdom/jsdom). Tr∆∞·ªõc khi test ch·∫°y, m·ªôt global Nuxt app s·∫Ω ƒë∆∞·ª£c kh·ªüi t·∫°o (bao g·ªìm, v√≠ d·ª•, ch·∫°y b·∫•t k·ª≥ plugin ho·∫∑c code n√†o b·∫°n ƒë√£ ƒë·ªãnh nghƒ©a trong `app.vue`).

ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n n√™n ƒë·∫∑c bi·ªát c·∫©n th·∫≠n ƒë·ªÉ kh√¥ng thay ƒë·ªïi global state trong test (ho·∫∑c, n·∫øu c·∫ßn, reset n√≥ sau ƒë√≥).
::

### üé≠ Built-In Mocks

`@nuxt/test-utils` cung c·∫•p m·ªôt s·ªë built-in mock cho DOM environment.

#### `intersectionObserver`

M·∫∑c ƒë·ªãnh `true`, t·∫°o m·ªôt dummy class kh√¥ng c√≥ ch·ª©c nƒÉng g√¨ cho IntersectionObserver API

#### `indexedDB`

M·∫∑c ƒë·ªãnh `false`, s·ª≠ d·ª•ng [`fake-indexeddb`](https://github.com/dumbmatter/fakeIndexedDB) ƒë·ªÉ t·∫°o m·ªôt mock ch·ª©c nƒÉng c·ªßa IndexedDB API

Nh·ªØng th·ª© n√†y c√≥ th·ªÉ ƒë∆∞·ª£c c·∫•u h√¨nh trong ph·∫ßn `environmentOptions` c·ªßa file `vitest.config.ts`:

```ts twoslash
import { defineVitestConfig } from '@nuxt/test-utils/config'

export default defineVitestConfig({
  test: {
    environmentOptions: {
      nuxt: {
        mock: {
          intersectionObserver: true,
          indexedDb: true,
        }
      }
    }
  }
})
```

### üõ†Ô∏è Helpers

`@nuxt/test-utils` cung c·∫•p m·ªôt s·ªë helper ƒë·ªÉ l√†m cho vi·ªác test Nuxt app d·ªÖ d√†ng h∆°n.

#### `mountSuspended`

`mountSuspended` cho ph√©p b·∫°n mount b·∫•t k·ª≥ Vue component n√†o trong Nuxt environment, cho ph√©p async setup v√† truy c·∫≠p v√†o injection t·ª´ Nuxt plugin c·ªßa b·∫°n.

::note
B√™n d∆∞·ªõi, `mountSuspended` wrap `mount` t·ª´ `@vue/test-utils`, v√¨ v·∫≠y b·∫°n c√≥ th·ªÉ xem [t√†i li·ªáu Vue Test Utils](https://test-utils.vuejs.org/guide/) ƒë·ªÉ bi·∫øt th√™m v·ªÅ c√°c t√πy ch·ªçn b·∫°n c√≥ th·ªÉ truy·ªÅn, v√† c√°ch s·ª≠ d·ª•ng utility n√†y.
::

V√≠ d·ª•:

```ts twoslash
// @noErrors
import { it, expect } from 'vitest'
import type { Component } from 'vue'
declare module '#components' {
  export const SomeComponent: Component
}
// ---cut---
// tests/components/SomeComponents.nuxt.spec.ts
import { mountSuspended } from '@nuxt/test-utils/runtime'
import { SomeComponent } from '#components'

it('can mount some component', async () => {
    const component = await mountSuspended(SomeComponent)
    expect(component.text()).toMatchInlineSnapshot(
        '"This is an auto-imported component"'
    )
})

```

```ts twoslash
// @noErrors
import { it, expect } from 'vitest'
// ---cut---
// tests/components/SomeComponents.nuxt.spec.ts
import { mountSuspended } from '@nuxt/test-utils/runtime'
import App from '~/app.vue'

// tests/App.nuxt.spec.ts
it('can also mount an app', async () => {
    const component = await mountSuspended(App, { route: '/test' })
    expect(component.html()).toMatchInlineSnapshot(`
      "<div>This is an auto-imported component</div>
      <div> I am a global component </div>
      <div>/</div>
      <a href="/test"> Test link </a>"
    `)
})
```

#### `renderSuspended`

`renderSuspended` cho ph√©p b·∫°n render b·∫•t k·ª≥ Vue component n√†o trong Nuxt environment s·ª≠ d·ª•ng `@testing-library/vue`, cho ph√©p async setup v√† truy c·∫≠p v√†o injection t·ª´ Nuxt plugin c·ªßa b·∫°n.

ƒêi·ªÅu n√†y n√™n ƒë∆∞·ª£c s·ª≠ d·ª•ng c√πng v·ªõi c√°c utility t·ª´ Testing Library, v√≠ d·ª• `screen` v√† `fireEvent`. C√†i ƒë·∫∑t [@testing-library/vue](https://testing-library.com/docs/vue-testing-library/intro) trong d·ª± √°n c·ªßa b·∫°n ƒë·ªÉ s·ª≠ d·ª•ng nh·ªØng th·ª© n√†y.

Ngo√†i ra, Testing Library c≈©ng d·ª±a v√†o testing global ƒë·ªÉ cleanup. B·∫°n n√™n b·∫≠t nh·ªØng th·ª© n√†y trong [Vitest config](https://vitest.dev/config/#globals) c·ªßa b·∫°n.

Component ƒë∆∞·ª£c truy·ªÅn v√†o s·∫Ω ƒë∆∞·ª£c render b√™n trong `<div id="test-wrapper"></div>`.

V√≠ d·ª•:

```ts twoslash
// @noErrors
import { it, expect } from 'vitest'
import type { Component } from 'vue'
declare module '#components' {
  export const SomeComponent: Component
}
// ---cut---
// tests/components/SomeComponents.nuxt.spec.ts
import { renderSuspended } from '@nuxt/test-utils/runtime'
import { SomeComponent } from '#components'
import { screen } from '@testing-library/vue'

it('can render some component', async () => {
  await renderSuspended(SomeComponent)
  expect(screen.getByText('This is an auto-imported component')).toBeDefined()
})
```

```ts twoslash
// @noErrors
import { it, expect } from 'vitest'
// ---cut---
// tests/App.nuxt.spec.ts
import { renderSuspended } from '@nuxt/test-utils/runtime'
import App from '~/app.vue'

it('can also render an app', async () => {
  const html = await renderSuspended(App, { route: '/test' })
  expect(html).toMatchInlineSnapshot(`
    "<div id="test-wrapper">
      <div>This is an auto-imported component</div>
      <div> I am a global component </div>
      <div>Index page</div><a href="/test"> Test link </a>
    </div>"
  `)
})
```

#### `mockNuxtImport`

`mockNuxtImport` cho ph√©p b·∫°n mock ch·ª©c nƒÉng auto import c·ªßa Nuxt. V√≠ d·ª•, ƒë·ªÉ mock `useStorage`, b·∫°n c√≥ th·ªÉ l√†m nh∆∞ th·∫ø n√†y:

```ts twoslash
import { mockNuxtImport } from '@nuxt/test-utils/runtime'

mockNuxtImport('useStorage', () => {
  return () => {
    return { value: 'mocked storage' }
  }
})

// test c·ªßa b·∫°n ·ªü ƒë√¢y
```

::note
`mockNuxtImport` ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng m·ªôt l·∫ßn cho m·ªói mocked import cho m·ªói test file. N√≥ th·ª±c s·ª± l√† m·ªôt macro ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi th√†nh `vi.mock` v√† `vi.mock` ƒë∆∞·ª£c hoisted, nh∆∞ ƒë∆∞·ª£c m√¥ t·∫£ [trong Vitest docs](https://vitest.dev/api/vi.html#vi-mock).
::

N·∫øu b·∫°n c·∫ßn mock m·ªôt Nuxt import v√† cung c·∫•p implementation kh√°c nhau gi·ªØa c√°c test, b·∫°n c√≥ th·ªÉ l√†m ƒëi·ªÅu ƒë√≥ b·∫±ng c√°ch t·∫°o v√† expose mock c·ªßa b·∫°n s·ª≠ d·ª•ng [`vi.hoisted`](https://vitest.dev/api/vi.html#vi-hoisted), v√† sau ƒë√≥ s·ª≠ d·ª•ng nh·ªØng mock ƒë√≥ trong `mockNuxtImport`. Sau ƒë√≥ b·∫°n c√≥ quy·ªÅn truy c·∫≠p v√†o mocked import, v√† c√≥ th·ªÉ thay ƒë·ªïi implementation gi·ªØa c√°c test. H√£y c·∫©n th·∫≠n [restore mock](https://vitest.dev/api/mock.html#mockrestore) tr∆∞·ªõc ho·∫∑c sau m·ªói test ƒë·ªÉ ho√†n t√°c thay ƒë·ªïi mock state gi·ªØa c√°c l·∫ßn ch·∫°y.

```ts twoslash
import { vi } from 'vitest'
import { mockNuxtImport } from '@nuxt/test-utils/runtime'

const { useStorageMock } = vi.hoisted(() => {
  return {
    useStorageMock: vi.fn(() => {
      return { value: 'mocked storage'}
    })
  }
})

mockNuxtImport('useStorage', () => {
  return useStorageMock
})

// Sau ƒë√≥, b√™n trong m·ªôt test
useStorageMock.mockImplementation(() => {
  return { value: 'something else' }
})
```

#### `mockComponent`

`mockComponent` cho ph√©p b·∫°n mock component c·ªßa Nuxt.
Argument ƒë·∫ßu ti√™n c√≥ th·ªÉ l√† t√™n component trong PascalCase, ho·∫∑c relative path c·ªßa component.
Argument th·ª© hai l√† m·ªôt factory function tr·∫£ v·ªÅ mocked component.

V√≠ d·ª•, ƒë·ªÉ mock `MyComponent`, b·∫°n c√≥ th·ªÉ:

```ts twoslash
import { mockComponent } from '@nuxt/test-utils/runtime'

mockComponent('MyComponent', {
  props: {
    value: String
  },
  setup(props) {
    // ...
  }
})

// relative path ho·∫∑c alias c≈©ng ho·∫°t ƒë·ªông
mockComponent('~/components/my-component.vue', async () => {
  // ho·∫∑c m·ªôt factory function
  return defineComponent({
    setup(props) {
      // ...
    }
  })
})

// ho·∫∑c b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng SFC ƒë·ªÉ redirect ƒë·∫øn m·ªôt mock component
mockComponent('MyComponent', () => import('./MockComponent.vue'))

// test c·ªßa b·∫°n ·ªü ƒë√¢y
```

> **L∆∞u √Ω**: B·∫°n kh√¥ng th·ªÉ tham chi·∫øu local variable trong factory function v√¨ ch√∫ng ƒë∆∞·ª£c hoisted. N·∫øu b·∫°n c·∫ßn truy c·∫≠p Vue API ho·∫∑c c√°c variable kh√°c, b·∫°n c·∫ßn import ch√∫ng trong factory function c·ªßa b·∫°n.

```ts twoslash
import { mockComponent } from '@nuxt/test-utils/runtime'

mockComponent('MyComponent', async () => {
  const { ref, h } = await import('vue')

  return defineComponent({
    setup(props) {
      const counter = ref(0)
      return () => h('div', null, counter.value)
    }
  })
})
```

#### `registerEndpoint`

`registerEndpoint` cho ph√©p b·∫°n t·∫°o Nitro endpoint tr·∫£ v·ªÅ mocked data. N√≥ c√≥ th·ªÉ h·ªØu √≠ch n·∫øu b·∫°n mu·ªën test m·ªôt component th·ª±c hi·ªán request ƒë·∫øn API ƒë·ªÉ hi·ªÉn th·ªã m·ªôt s·ªë d·ªØ li·ªáu.

Argument ƒë·∫ßu ti√™n l√† t√™n endpoint (v√≠ d·ª• `/test/`).
Argument th·ª© hai l√† m·ªôt factory function tr·∫£ v·ªÅ mocked data.

V√≠ d·ª•, ƒë·ªÉ mock endpoint `/test/`, b·∫°n c√≥ th·ªÉ l√†m:

```ts twoslash
import { registerEndpoint } from '@nuxt/test-utils/runtime'

registerEndpoint('/test/', () => ({
  test: 'test-field'
}))
```

Theo m·∫∑c ƒë·ªãnh, request c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c th·ª±c hi·ªán s·ª≠ d·ª•ng method `GET`. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng method kh√°c b·∫±ng c√°ch ƒë·∫∑t m·ªôt object l√†m argument th·ª© hai thay v√¨ function.

```ts twoslash
import { registerEndpoint } from '@nuxt/test-utils/runtime'

registerEndpoint('/test/', {
  method: 'POST',
  handler: () => ({ test: 'test-field' })
})
```

> **L∆∞u √Ω**: N·∫øu request trong component ƒëi ƒë·∫øn external API, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `baseURL` v√† sau ƒë√≥ l√†m n√≥ tr·ªëng s·ª≠ d·ª•ng [Nuxt Environment Override Config](/docs/getting-started/configuration#environment-overrides) (`$test`) ƒë·ªÉ t·∫•t c·∫£ request c·ªßa b·∫°n s·∫Ω ƒëi ƒë·∫øn Nitro server.

#### Conflict with End-To-End Testing

`@nuxt/test-utils/runtime` v√† `@nuxt/test-utils/e2e` c·∫ßn ch·∫°y trong c√°c testing environment kh√°c nhau v√† do ƒë√≥ kh√¥ng th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√πng m·ªôt file.

N·∫øu b·∫°n mu·ªën s·ª≠ d·ª•ng c·∫£ end-to-end v√† unit testing functionality c·ªßa `@nuxt/test-utils`, b·∫°n c√≥ th·ªÉ t√°ch test c·ªßa m√¨nh th√†nh c√°c file ri√™ng bi·ªát. Sau ƒë√≥ b·∫°n ch·ªâ ƒë·ªãnh test environment per-file v·ªõi comment ƒë·∫∑c bi·ªát `// @vitest-environment nuxt`, ho·∫∑c ƒë·∫∑t t√™n c√°c runtime unit test file v·ªõi extension `.nuxt.spec.ts`.

`app.nuxt.spec.ts`

```ts twoslash
import { mockNuxtImport } from '@nuxt/test-utils/runtime'

mockNuxtImport('useStorage', () => {
  return () => {
    return { value: 'mocked storage' }
  }
})

```

`app.e2e.spec.ts`

```ts twoslash
import { setup, $fetch } from '@nuxt/test-utils/e2e'

await setup({
  setupTimeout: 10000,
})

// ...
```

### Using `@vue/test-utils`

N·∫øu b·∫°n th√≠ch s·ª≠ d·ª•ng `@vue/test-utils` m·ªôt m√¨nh cho unit testing trong Nuxt, v√† b·∫°n ch·ªâ test c√°c component kh√¥ng d·ª±a v√†o Nuxt composable, auto-import ho·∫∑c context, b·∫°n c√≥ th·ªÉ l√†m theo c√°c b∆∞·ªõc n√†y ƒë·ªÉ thi·∫øt l·∫≠p.

1. C√†i ƒë·∫∑t c√°c dependency c·∫ßn thi·∫øt

   ::code-group{sync="pm"}
   ```bash [npm]
   npm i --save-dev vitest @vue/test-utils happy-dom @vitejs/plugin-vue
   ```
   ```bash [yarn]
   yarn add --dev vitest @vue/test-utils happy-dom @vitejs/plugin-vue
   ```
   ```bash [pnpm]
   pnpm add -D vitest @vue/test-utils happy-dom @vitejs/plugin-vue
   ```
   ```bash [bun]
   bun add --dev vitest @vue/test-utils happy-dom @vitejs/plugin-vue
   ```
   ::

2. T·∫°o `vitest.config.ts` v·ªõi n·ªôi dung sau:

   ```ts
   import { defineConfig } from 'vitest/config'
   import vue from '@vitejs/plugin-vue'

   export default defineConfig({
     plugins: [vue()],
     test: {
       environment: 'happy-dom',
     },
   });
   ```

3. Th√™m command m·ªõi cho test trong `package.json`

   ```json
   "scripts": {
     "build": "nuxt build",
     "dev": "nuxt dev",
     ...
     "test": "vitest"
   },
   ```

4. T·∫°o m·ªôt component `<HelloWorld>` ƒë∆°n gi·∫£n `components/HelloWorld.vue` v·ªõi n·ªôi dung sau:

   ```vue
   <template>
     <p>Hello world</p>
   </template>
   ```

5. T·∫°o m·ªôt unit test ƒë∆°n gi·∫£n cho component m·ªõi ƒë∆∞·ª£c t·∫°o n√†y `~/components/HelloWorld.spec.ts`

   ```ts twoslash
   import { describe, it, expect } from 'vitest'
   import { mount } from '@vue/test-utils'

   import HelloWorld from './HelloWorld.vue'

   describe('HelloWorld', () => {
     it('component renders Hello world properly', () => {
       const wrapper = mount(HelloWorld)
       expect(wrapper.text()).toContain('Hello world')
     })
   })
   ```

6. Ch·∫°y l·ªánh vitest

   ::code-group{sync="pm"}
   ```bash [npm]
   npm run test
   ```
   ```bash [yarn]
   yarn test
   ```
   ```bash [pnpm]
   pnpm run test
   ```
   ```bash [bun]
   bun run test
   ```
   ::

Ch√∫c m·ª´ng, b·∫°n ƒë√£ s·∫µn s√†ng ƒë·ªÉ b·∫Øt ƒë·∫ßu unit testing v·ªõi `@vue/test-utils` trong Nuxt! Happy testing!

## End-To-End Testing

Cho end-to-end testing, ch√∫ng t√¥i h·ªó tr·ª£ [Vitest](https://github.com/vitest-dev/vitest), [Jest](https://jestjs.io), [Cucumber](https://cucumber.io/) v√† [Playwright](https://playwright.dev/) l√†m test runner.

### Setup

Trong m·ªói block `describe` n∆°i b·∫°n ƒëang t·∫≠n d·ª•ng c√°c helper method `@nuxt/test-utils/e2e`, b·∫°n s·∫Ω c·∫ßn thi·∫øt l·∫≠p test context tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu.

```ts twoslash [test/my-test.spec.ts]
import { describe, test } from 'vitest'
import { setup, $fetch } from '@nuxt/test-utils/e2e'

describe('My test', async () => {
  await setup({
    // test context options
  })

  test('my test', () => {
    // ...
  })
})
```

ƒê·∫±ng sau h·∫≠u tr∆∞·ªùng, `setup` th·ª±c hi·ªán m·ªôt s·ªë t√°c v·ª• trong `beforeAll`, `beforeEach`, `afterEach` v√† `afterAll` ƒë·ªÉ thi·∫øt l·∫≠p Nuxt test environment m·ªôt c√°ch ch√≠nh x√°c.

Vui l√≤ng s·ª≠ d·ª•ng c√°c t√πy ch·ªçn d∆∞·ªõi ƒë√¢y cho method `setup`.

#### Nuxt Config

- `rootDir`: Path ƒë·∫øn th∆∞ m·ª•c v·ªõi Nuxt app ƒë∆∞·ª£c ƒë∆∞a v√†o test.
  - Type: `string`
  - Default: `'.'`
- `configFile`: T√™n c·ªßa configuration file.
  - Type: `string`
  - Default: `'nuxt.config'`

<!--
- `config`: Object v·ªõi configuration override.
  - Type: `NuxtConfig`
  - Default: `{}` -->

#### Timings

- `setupTimeout`: L∆∞·ª£ng th·ªùi gian (t√≠nh b·∫±ng millisecond) cho ph√©p `setupTest` ho√†n th√†nh c√¥ng vi·ªác c·ªßa n√≥ (c√≥ th·ªÉ bao g·ªìm building ho·∫∑c generating file cho Nuxt application, t√πy thu·ªôc v√†o c√°c t√πy ch·ªçn ƒë∆∞·ª£c truy·ªÅn).
  - Type: `number`
  - Default: `120000` ho·∫∑c `240000` tr√™n windows

- `teardownTimeout`: L∆∞·ª£ng th·ªùi gian (t√≠nh b·∫±ng millisecond) ƒë·ªÉ cho ph√©p tearing down test environment, ch·∫≥ng h·∫°n nh∆∞ ƒë√≥ng browser.
  - Type: `number`
  - Default: `30000`

#### Features

- `build`: C√≥ ch·∫°y m·ªôt build step ri√™ng bi·ªát hay kh√¥ng.
  - Type: `boolean`
  - Default: `true` (`false` n·∫øu `browser` ho·∫∑c `server` b·ªã disable, ho·∫∑c n·∫øu `host` ƒë∆∞·ª£c cung c·∫•p)

- `server`: C√≥ kh·ªüi ch·∫°y server ƒë·ªÉ respond request trong test suite hay kh√¥ng.
  - Type: `boolean`
  - Default: `true` (`false` n·∫øu `host` ƒë∆∞·ª£c cung c·∫•p)

- `port`: N·∫øu ƒë∆∞·ª£c cung c·∫•p, ƒë·∫∑t port c·ªßa test server ƒë∆∞·ª£c kh·ªüi ch·∫°y th√†nh gi√° tr·ªã n√†y.
  - Type: `number | undefined`
  - Default: `undefined`

- `host`: N·∫øu ƒë∆∞·ª£c cung c·∫•p, m·ªôt URL ƒë·ªÉ s·ª≠ d·ª•ng l√†m test target thay v√¨ building v√† ch·∫°y server m·ªõi. H·ªØu √≠ch ƒë·ªÉ ch·∫°y "th·∫≠t" end-to-end test v·ªõi phi√™n b·∫£n deployed c·ªßa ·ª©ng d·ª•ng, ho·∫∑c v·ªõi local server ƒëang ch·∫°y (c√≥ th·ªÉ cung c·∫•p gi·∫£m ƒë√°ng k·ªÉ th·ªùi gian th·ª±c thi test). Xem [target host end-to-end example b√™n d∆∞·ªõi](#target-host-end-to-end-example).
  - Type: `string`
  - Default: `undefined`

- `browser`: ƒê·∫±ng sau h·∫≠u tr∆∞·ªùng, Nuxt test utils s·ª≠ d·ª•ng [`playwright`](https://playwright.dev) ƒë·ªÉ th·ª±c hi·ªán browser testing. N·∫øu t√πy ch·ªçn n√†y ƒë∆∞·ª£c ƒë·∫∑t, m·ªôt browser s·∫Ω ƒë∆∞·ª£c kh·ªüi ch·∫°y v√† c√≥ th·ªÉ ƒë∆∞·ª£c ki·ªÉm so√°t trong test suite ti·∫øp theo.
  - Type: `boolean`
  - Default: `false`
- `browserOptions`
  - Type: `object` v·ªõi c√°c thu·ªôc t√≠nh sau
    - `type`: Lo·∫°i browser ƒë·ªÉ kh·ªüi ch·∫°y - `chromium`, `firefox` ho·∫∑c `webkit`
    - `launch`: `object` c√°c t√πy ch·ªçn s·∫Ω ƒë∆∞·ª£c truy·ªÅn cho playwright khi kh·ªüi ch·∫°y browser. Xem [full API reference](https://playwright.dev/docs/api/class-browsertype#browser-type-launch).
- `runner`: Ch·ªâ ƒë·ªãnh runner cho test suite. Hi·ªán t·∫°i, [Vitest](https://vitest.dev) ƒë∆∞·ª£c khuy·∫øn ngh·ªã.
  - Type: `'vitest' | 'jest' | 'cucumber'`
  - Default: `'vitest'`

##### Target `host` end-to-end example

M·ªôt use-case ph·ªï bi·∫øn cho end-to-end testing l√† ch·∫°y test v·ªõi deployed application ch·∫°y trong c√πng environment th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng cho Production.

Cho local development ho·∫∑c automated deploy pipeline, testing v·ªõi separate local server c√≥ th·ªÉ hi·ªáu qu·∫£ h∆°n v√† th∆∞·ªùng nhanh h∆°n so v·ªõi vi·ªác cho ph√©p test framework rebuild gi·ªØa c√°c test.

ƒê·ªÉ s·ª≠ d·ª•ng separate target host cho end-to-end test, ch·ªâ c·∫ßn cung c·∫•p thu·ªôc t√≠nh `host` c·ªßa function `setup` v·ªõi URL mong mu·ªën.

```ts
import { setup, createPage } from '@nuxt/test-utils/e2e'
import { describe, it, expect } from 'vitest'

describe('login page', async () => {
  await setup({
    host: 'http://localhost:8787',
  })

  it('displays the email and password fields', async () => {
    const page = await createPage('/login')
    expect(await page.getByTestId('email').isVisible()).toBe(true)
    expect(await page.getByTestId('password').isVisible()).toBe(true)
  })
})
```

### APIs

#### `$fetch(url)`

L·∫•y HTML c·ªßa server-rendered page.

```ts twoslash
import { $fetch } from '@nuxt/test-utils/e2e'

const html = await $fetch('/')
```

#### `fetch(url)`

L·∫•y response c·ªßa server-rendered page.

```ts twoslash
import { fetch } from '@nuxt/test-utils/e2e'

const res = await fetch('/')
const { body, headers } = res
```

#### `url(path)`

L·∫•y URL ƒë·∫ßy ƒë·ªß cho m·ªôt trang nh·∫•t ƒë·ªãnh (bao g·ªìm c·∫£ port m√† server test ƒëang ch·∫°y).

```ts twoslash
import { url } from '@nuxt/test-utils/e2e'

const pageUrl = url('/page')
// 'http://localhost:6840/page'
```

### Testing in a Browser

Ch√∫ng t√¥i cung c·∫•p h·ªó tr·ª£ t√≠ch h·ª£p s·∫µn b·∫±ng Playwright trong `@nuxt/test-utils`, c√≥ th·ªÉ s·ª≠ d·ª•ng qua code ho·∫∑c th√¥ng qua Playwright test runner.

#### `createPage(url)`

Trong `vitest`, `jest` ho·∫∑c `cucumber`, b·∫°n c√≥ th·ªÉ t·∫°o m·ªôt instance tr√¨nh duy·ªát Playwright ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh v·ªõi `createPage`, v√† (tu·ª≥ ch·ªçn) tr·ªè n√≥ ƒë·∫øn m·ªôt ƒë∆∞·ªùng d·∫´n t·ª´ server ƒëang ch·∫°y. B·∫°n c√≥ th·ªÉ t√¨m hi·ªÉu th√™m v·ªÅ c√°c ph∆∞∆°ng th·ª©c API c√≥ s·∫µn trong [t√†i li·ªáu Playwright](https://playwright.dev/docs/api/class-page).

```ts twoslash
import { createPage } from '@nuxt/test-utils/e2e'

const page = await createPage('/page')
// b·∫°n c√≥ th·ªÉ truy c·∫≠p t·∫•t c·∫£ API c·ªßa Playwright t·ª´ bi·∫øn `page`
```

#### Testing with Playwright Test Runner

Ch√∫ng t√¥i c≈©ng cung c·∫•p h·ªó tr·ª£ tr·ª±c ti·∫øp cho vi·ªác test Nuxt b·∫±ng [Playwright test runner](https://playwright.dev/docs/intro).

::code-group{sync="pm"}
```bash [npm]
npm i --save-dev @playwright/test @nuxt/test-utils
```
```bash [yarn]
yarn add --dev @playwright/test @nuxt/test-utils
```
```bash [pnpm]
pnpm add -D @playwright/test @nuxt/test-utils
```
```bash [bun]
bun add --dev @playwright/test @nuxt/test-utils
```
::

B·∫°n c√≥ th·ªÉ cung c·∫•p c·∫•u h√¨nh Nuxt to√†n c·ª•c, v·ªõi chi ti·∫øt c·∫•u h√¨nh gi·ªëng nh∆∞ h√†m `setup()` ƒë√£ ƒë·ªÅ c·∫≠p ·ªü ph·∫ßn tr∆∞·ªõc.

```ts [playwright.config.ts]
import { fileURLToPath } from 'node:url'
import { defineConfig, devices } from '@playwright/test'
import type { ConfigOptions } from '@nuxt/test-utils/playwright'

export default defineConfig<ConfigOptions>({
  use: {
    nuxt: {
      rootDir: fileURLToPath(new URL('.', import.meta.url))
    }
  },
  // ...
})
```

::read-more{title="See full example config" to="https://github.com/nuxt/test-utils/blob/main/examples/app-playwright/playwright.config.ts" target="_blank"}
::

File test c·ªßa b·∫°n sau ƒë√≥ n√™n s·ª≠ d·ª•ng `expect` v√† `test` tr·ª±c ti·∫øp t·ª´ `@nuxt/test-utils/playwright`:

```ts [tests/example.test.ts]
import { expect, test } from '@nuxt/test-utils/playwright'

test('test', async ({ page, goto }) => {
  await goto('/', { waitUntil: 'hydration' })
  await expect(page.getByRole('heading')).toHaveText('Welcome to Playwright!')
})
```

Ngo√†i ra, b·∫°n c≈©ng c√≥ th·ªÉ c·∫•u h√¨nh Nuxt server tr·ª±c ti·∫øp trong file test c·ªßa m√¨nh:

```ts [tests/example.test.ts]
import { expect, test } from '@nuxt/test-utils/playwright'

test.use({
  nuxt: {
    rootDir: fileURLToPath(new URL('..', import.meta.url))
  }
})

test('test', async ({ page, goto }) => {
  await goto('/', { waitUntil: 'hydration' })
  await expect(page.getByRole('heading')).toHaveText('Welcome to Playwright!')
})
```
