---
title: Upgrade Guide
description: 'TÃ¬m hiá»ƒu cÃ¡ch nÃ¢ng cáº¥p lÃªn phiÃªn báº£n Nuxt má»›i nháº¥t.'
navigation.icon: i-lucide-circle-arrow-up
---

## NÃ¢ng cáº¥p Nuxt

### Báº£n phÃ¡t hÃ nh má»›i nháº¥t

Äá»ƒ nÃ¢ng cáº¥p Nuxt lÃªn [báº£n phÃ¡t hÃ nh má»›i nháº¥t](https://github.com/nuxt/nuxt/releases), hÃ£y sá»­ dá»¥ng lá»‡nh `nuxt upgrade`.

::code-group{sync="pm"}

```bash [npm]
npx nuxt upgrade
```

```bash [yarn]
yarn nuxt upgrade
```

```bash [pnpm]
pnpm nuxt upgrade
```

```bash [bun]
bun x nuxt upgrade
```

::

### KÃªnh phÃ¡t hÃ nh hÃ ng Ä‘Ãªm

Äá»ƒ sá»­ dá»¥ng báº£n build Nuxt má»›i nháº¥t vÃ  kiá»ƒm tra cÃ¡c tÃ­nh nÄƒng trÆ°á»›c khi chÃºng Ä‘Æ°á»£c phÃ¡t hÃ nh, hÃ£y Ä‘á»c vá» hÆ°á»›ng dáº«n [kÃªnh phÃ¡t hÃ nh hÃ ng Ä‘Ãªm](/docs/guide/going-further/nightly-release-channel).

## Di chuyá»ƒn sang Nuxt 4

Nuxt 4 bao gá»“m cÃ¡c cáº£i tiáº¿n vÃ  thay Ä‘á»•i Ä‘Ã¡ng ká»ƒ. HÆ°á»›ng dáº«n nÃ y sáº½ giÃºp báº¡n di chuyá»ƒn á»©ng dá»¥ng Nuxt 3 hiá»‡n táº¡i sang Nuxt 4.

Äáº§u tiÃªn, nÃ¢ng cáº¥p lÃªn Nuxt 4:

::code-group{sync="pm"}

```bash [npm]
npm install nuxt@^4.0.0
```

```bash [yarn]
yarn add nuxt@^4.0.0
```

```bash [pnpm]
pnpm add nuxt@^4.0.0
```

```bash [bun]
bun add nuxt@^4.0.0
```

::

Sau khi nÃ¢ng cáº¥p, háº§u háº¿t cÃ¡c hÃ nh vi cá»§a Nuxt 4 giá» Ä‘Ã¢y lÃ  máº·c Ä‘á»‹nh. Tuy nhiÃªn, má»™t sá»‘ tÃ­nh nÄƒng váº«n cÃ³ thá»ƒ Ä‘Æ°á»£c cáº¥u hÃ¬nh náº¿u báº¡n cáº§n duy trÃ¬ kháº£ nÄƒng tÆ°Æ¡ng thÃ­ch ngÆ°á»£c trong quÃ¡ trÃ¬nh di chuyá»ƒn.

CÃ¡c pháº§n sau Ä‘Ã¢y mÃ´ táº£ chi tiáº¿t vá» nhá»¯ng thay Ä‘á»•i chÃ­nh vÃ  viá»‡c di chuyá»ƒn cáº§n thiáº¿t khi nÃ¢ng cáº¥p lÃªn Nuxt 4.

CÃ¡c thay Ä‘á»•i phÃ¡ vá»¡ hoáº·c Ä‘Ã¡ng ká»ƒ Ä‘Æ°á»£c ghi láº¡i bÃªn dÆ°á»›i cÃ¹ng vá»›i cÃ¡c bÆ°á»›c di chuyá»ƒn vÃ  tÃ¹y chá»n cáº¥u hÃ¬nh cÃ³ sáºµn.

### Di chuyá»ƒn sá»­ dá»¥ng Codemods

Äá»ƒ táº¡o Ä‘iá»u kiá»‡n cho quÃ¡ trÃ¬nh nÃ¢ng cáº¥p, chÃºng tÃ´i Ä‘Ã£ há»£p tÃ¡c vá»›i nhÃ³m [Codemod](https://github.com/codemod-com/codemod) Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a nhiá»u bÆ°á»›c di chuyá»ƒn vá»›i má»™t sá»‘ codemods mÃ£ nguá»“n má»Ÿ.

::note
Náº¿u báº¡n gáº·p báº¥t ká»³ váº¥n Ä‘á» nÃ o, vui lÃ²ng bÃ¡o cÃ¡o chÃºng cho nhÃ³m Codemod vá»›i `npx codemod feedback` ğŸ™
::

Äá»ƒ cÃ³ danh sÃ¡ch Ä‘áº§y Ä‘á»§ cÃ¡c codemods cá»§a Nuxt 4, thÃ´ng tin chi tiáº¿t vá» tá»«ng codemod, nguá»“n cá»§a chÃºng vÃ  cÃ¡c cÃ¡ch khÃ¡c nhau Ä‘á»ƒ cháº¡y chÃºng, hÃ£y truy cáº­p [Codemod Registry](https://go.codemod.com/codemod-registry).

Báº¡n cÃ³ thá»ƒ cháº¡y táº¥t cáº£ cÃ¡c codemods Ä‘Æ°á»£c Ä‘á» cáº­p trong hÆ°á»›ng dáº«n nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng `codemod` recipe sau:

::code-group

```bash [npm]
npx codemod@latest nuxt/4/migration-recipe
```

```bash [yarn]
yarn dlx codemod@latest nuxt/4/migration-recipe
```

```bash [pnpm]
pnpm dlx codemod@latest nuxt/4/migration-recipe
```

```bash [bun]
bun x codemod@latest nuxt/4/migration-recipe
```

::

Lá»‡nh nÃ y sáº½ thá»±c thi táº¥t cáº£ cÃ¡c codemods theo trÃ¬nh tá»±, vá»›i tÃ¹y chá»n bá» chá»n báº¥t ká»³ codemod nÃ o mÃ  báº¡n khÃ´ng muá»‘n cháº¡y. Má»—i codemod cÅ©ng Ä‘Æ°á»£c liá»‡t kÃª bÃªn dÆ°á»›i cÃ¹ng vá»›i thay Ä‘á»•i tÆ°Æ¡ng á»©ng cá»§a nÃ³ vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi Ä‘á»™c láº­p.

### Cáº¥u trÃºc thÆ° má»¥c má»›i

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: ÄÃ¡ng ká»ƒ

Nuxt giá» Ä‘Ã¢y máº·c Ä‘á»‹nh sá»­ dá»¥ng cáº¥u trÃºc thÆ° má»¥c má»›i, vá»›i kháº£ nÄƒng tÆ°Æ¡ng thÃ­ch ngÆ°á»£c (vÃ¬ váº­y náº¿u Nuxt phÃ¡t hiá»‡n báº¡n Ä‘ang sá»­ dá»¥ng cáº¥u trÃºc cÅ©, cháº³ng háº¡n nhÆ° thÆ° má»¥c `pages/` á»Ÿ cáº¥p cao nháº¥t, cáº¥u trÃºc má»›i nÃ y sáº½ khÃ´ng Ã¡p dá»¥ng).

ğŸ‘‰ [Xem RFC Ä‘áº§y Ä‘á»§](https://github.com/nuxt/nuxt/issues/26444)

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

* `srcDir` máº·c Ä‘á»‹nh má»›i cá»§a Nuxt lÃ  `app/` theo máº·c Ä‘á»‹nh, vÃ  háº§u háº¿t má»i thá»© Ä‘á»u Ä‘Æ°á»£c giáº£i quyáº¿t tá»« Ä‘Ã³.
* `serverDir` giá» Ä‘Ã¢y máº·c Ä‘á»‹nh lÃ  `<rootDir>/server` thay vÃ¬ `<srcDir>/server`
* `layers/`, `modules/` vÃ  `public/` Ä‘Æ°á»£c giáº£i quyáº¿t tÆ°Æ¡ng Ä‘á»‘i so vá»›i `<rootDir>` theo máº·c Ä‘á»‹nh
* náº¿u sá»­ dá»¥ng [Nuxt Content v2.13+](https://github.com/nuxt/content/pull/2649), `content/` Ä‘Æ°á»£c giáº£i quyáº¿t tÆ°Æ¡ng Ä‘á»‘i so vá»›i `<rootDir>`
* má»™t `dir.app` má»›i Ä‘Æ°á»£c thÃªm vÃ o, Ä‘Ã¢y lÃ  thÆ° má»¥c chÃºng tÃ´i tÃ¬m kiáº¿m `router.options.ts` vÃ  `spa-loading-template.html` - máº·c Ä‘á»‹nh nÃ y lÃ  `<srcDir>/`

<details>

<summary>Má»™t vÃ­ dá»¥ vá» cáº¥u trÃºc thÆ° má»¥c v4.</summary>

```sh
.output/
.nuxt/
app/
  assets/
  components/
  composables/
  layouts/
  middleware/
  pages/
  plugins/
  utils/
  app.config.ts
  app.vue
  router.options.ts
content/
layers/
modules/
node_modules/
public/
shared/
server/
  api/
  middleware/
  plugins/
  routes/
  utils/
nuxt.config.ts
```

::note
Vá»›i cáº¥u trÃºc má»›i nÃ y, alias `~` giá» Ä‘Ã¢y trá» Ä‘áº¿n thÆ° má»¥c `app/` theo máº·c Ä‘á»‹nh (`srcDir` cá»§a báº¡n). Äiá»u nÃ y cÃ³ nghÄ©a lÃ  `~/components` giáº£i quyáº¿t thÃ nh `app/components/`, `~/pages` thÃ nh `app/pages/`, v.v.
::

</details>

ğŸ‘‰ Äá»ƒ biáº¿t thÃªm chi tiáº¿t, xem [PR thá»±c hiá»‡n thay Ä‘á»•i nÃ y](https://github.com/nuxt/nuxt/pull/27029).

#### LÃ½ do thay Ä‘á»•i

1. **Hiá»‡u suáº¥t** - Ä‘áº·t táº¥t cáº£ mÃ£ cá»§a báº¡n trong thÆ° má»¥c gá»‘c cá»§a repo gÃ¢y ra váº¥n Ä‘á» vá»›i cÃ¡c thÆ° má»¥c `.git/` vÃ  `node_modules/` Ä‘Æ°á»£c quÃ©t/bao gá»“m bá»Ÿi FS watchers cÃ³ thá»ƒ lÃ m cháº­m Ä‘Ã¡ng ká»ƒ viá»‡c khá»Ÿi Ä‘á»™ng trÃªn cÃ¡c há»‡ Ä‘iá»u hÃ nh khÃ´ng pháº£i Mac.
1. **TÃ­nh an toÃ n kiá»ƒu IDE** - `server/` vÃ  pháº§n cÃ²n láº¡i cá»§a á»©ng dá»¥ng cá»§a báº¡n Ä‘ang cháº¡y trong hai ngá»¯ cáº£nh hoÃ n toÃ n khÃ¡c nhau vá»›i cÃ¡c import toÃ n cá»¥c khÃ¡c nhau cÃ³ sáºµn, vÃ  Ä‘áº£m báº£o `server/` khÃ´ng náº±m _trong_ cÃ¹ng thÆ° má»¥c vá»›i pháº§n cÃ²n láº¡i cá»§a á»©ng dá»¥ng lÃ  bÆ°á»›c Ä‘áº§u tiÃªn quan trá»ng Ä‘á»ƒ Ä‘áº£m báº£o báº¡n nháº­n Ä‘Æ°á»£c auto-completes tá»‘t trong IDE.

:video-accordion{title="Xem video tá»« Vue School vá» cáº¥u trÃºc thÆ° má»¥c má»›i" videoId="1031028378" platform="vimeo"}

#### BÆ°á»›c di chuyá»ƒn

1. Táº¡o má»™t thÆ° má»¥c má»›i cÃ³ tÃªn `app/`.
1. Di chuyá»ƒn cÃ¡c thÆ° má»¥c `assets/`, `components/`, `composables/`, `layouts/`, `middleware/`, `pages/`, `plugins/` vÃ  `utils/` cá»§a báº¡n vÃ o dÆ°á»›i nÃ³, cÅ©ng nhÆ° `app.vue`, `error.vue`, `app.config.ts`. Náº¿u báº¡n cÃ³ `app/router-options.ts` hoáº·c `app/spa-loading-template.html`, cÃ¡c Ä‘Æ°á»ng dáº«n nÃ y váº«n giá»¯ nguyÃªn.
1. Äáº£m báº£o cÃ¡c thÆ° má»¥c `nuxt.config.ts`, `content/`, `layers/`, `modules/`, `public/` vÃ  `server/` cá»§a báº¡n váº«n á»Ÿ bÃªn ngoÃ i thÆ° má»¥c `app/`, trong thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n.
1. Nhá»› cáº­p nháº­t báº¥t ká»³ tá»‡p cáº¥u hÃ¬nh cá»§a bÃªn thá»© ba nÃ o Ä‘á»ƒ hoáº¡t Ä‘á»™ng vá»›i cáº¥u trÃºc thÆ° má»¥c má»›i, cháº³ng háº¡n nhÆ° cáº¥u hÃ¬nh `tailwindcss` hoáº·c `eslint` cá»§a báº¡n (náº¿u cáº§n - `@nuxtjs/tailwindcss` sáº½ tá»± Ä‘á»™ng cáº¥u hÃ¬nh `tailwindcss` má»™t cÃ¡ch chÃ­nh xÃ¡c).

::tip
Báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng hÃ³a viá»‡c di chuyá»ƒn nÃ y báº±ng cÃ¡ch cháº¡y `npx codemod@latest nuxt/4/file-structure`
::

Tuy nhiÃªn, viá»‡c di chuyá»ƒn _khÃ´ng báº¯t buá»™c_. Náº¿u báº¡n muá»‘n giá»¯ cáº¥u trÃºc thÆ° má»¥c hiá»‡n táº¡i, Nuxt sáº½ tá»± Ä‘á»™ng phÃ¡t hiá»‡n nÃ³. (Náº¿u khÃ´ng, vui lÃ²ng táº¡o issue.) Ngoáº¡i lá»‡ duy nháº¥t lÃ  náº¿u báº¡n _Ä‘Ã£_ cÃ³ má»™t `srcDir` tÃ¹y chá»‰nh. Trong trÆ°á»ng há»£p nÃ y, báº¡n nÃªn biáº¿t ráº±ng cÃ¡c thÆ° má»¥c `modules/`, `public/` vÃ  `server/` cá»§a báº¡n sáº½ Ä‘Æ°á»£c giáº£i quyáº¿t tá»« `rootDir` thay vÃ¬ tá»« `srcDir` tÃ¹y chá»‰nh cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ ghi Ä‘Ã¨ Ä‘iá»u nÃ y báº±ng cÃ¡ch cáº¥u hÃ¬nh `dir.modules`, `dir.public` vÃ  `serverDir` náº¿u cáº§n.

Báº¡n cÅ©ng cÃ³ thá»ƒ buá»™c cáº¥u trÃºc thÆ° má»¥c v3 vá»›i cáº¥u hÃ¬nh sau:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  // Äiá»u nÃ y hoÃ n nguyÃªn srcDir máº·c Ä‘á»‹nh má»›i tá»« `app` vá» thÆ° má»¥c gá»‘c cá»§a báº¡n
  srcDir: '.',
  // Äiá»u nÃ y chá»‰ Ä‘á»‹nh tiá»n tá»‘ thÆ° má»¥c cho `router.options.ts` vÃ  `spa-loading-template.html`
  dir: {
    app: 'app'
  }
})
```

### Lá»›p Data Fetching Ä‘Æ¡n láº»

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Vá»«a pháº£i

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Há»‡ thá»‘ng data fetching cá»§a Nuxt (`useAsyncData` vÃ  `useFetch`) Ä‘Ã£ Ä‘Æ°á»£c tá»• chá»©c láº¡i Ä‘Ã¡ng ká»ƒ Ä‘á»ƒ cÃ³ hiá»‡u suáº¥t vÃ  tÃ­nh nháº¥t quÃ¡n tá»‘t hÆ¡n:

1. **Shared refs cho cÃ¹ng key**: Táº¥t cáº£ cÃ¡c lá»i gá»i Ä‘áº¿n `useAsyncData` hoáº·c `useFetch` vá»›i cÃ¹ng key giá» Ä‘Ã¢y chia sáº» cÃ¹ng `data`, `error` vÃ  `status` refs. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  viá»‡c táº¥t cáº£ cÃ¡c lá»i gá»i vá»›i key rÃµ rÃ ng khÃ´ng Ä‘Æ°á»£c cÃ³ cÃ¡c tÃ¹y chá»n `deep`, `transform`, `pick`, `getCachedData` hoáº·c `default` xung Ä‘á»™t lÃ  quan trá»ng.

2. **Kiá»ƒm soÃ¡t nhiá»u hÆ¡n Ä‘á»‘i vá»›i `getCachedData`**: HÃ m `getCachedData` giá» Ä‘Ã¢y Ä‘Æ°á»£c gá»i má»—i khi dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y, ngay cáº£ khi Ä‘iá»u nÃ y do watcher hoáº·c gá»i `refreshNuxtData` gÃ¢y ra. (TrÆ°á»›c Ä‘Ã¢y, dá»¯ liá»‡u má»›i luÃ´n Ä‘Æ°á»£c láº¥y vÃ  hÃ m nÃ y khÃ´ng Ä‘Æ°á»£c gá»i trong nhá»¯ng trÆ°á»ng há»£p nÃ y.) Äá»ƒ cho phÃ©p kiá»ƒm soÃ¡t nhiá»u hÆ¡n vá» thá»i Ä‘iá»ƒm sá»­ dá»¥ng dá»¯ liá»‡u Ä‘Ã£ cache vÃ  khi nÃ o refetch, hÃ m giá» Ä‘Ã¢y nháº­n má»™t Ä‘á»‘i tÆ°á»£ng context vá»›i nguyÃªn nhÃ¢n cá»§a yÃªu cáº§u.

3. **Há»— trá»£ reactive key**: Báº¡n giá» Ä‘Ã¢y cÃ³ thá»ƒ sá»­ dá»¥ng computed refs, plain refs hoáº·c getter functions lÃ m keys, Ä‘iá»u nÃ y cho phÃ©p tá»± Ä‘á»™ng refetching dá»¯ liá»‡u (vÃ  lÆ°u trá»¯ dá»¯ liá»‡u riÃªng biá»‡t).

4. **Dá»n dáº¹p dá»¯ liá»‡u**: Khi component cuá»‘i cÃ¹ng sá»­ dá»¥ng dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y vá»›i `useAsyncData` bá»‹ unmount, Nuxt sáº½ loáº¡i bá» dá»¯ liá»‡u Ä‘Ã³ Ä‘á»ƒ trÃ¡nh viá»‡c sá»­ dá»¥ng bá»™ nhá»› tÄƒng liÃªn tá»¥c.

#### LÃ½ do thay Ä‘á»•i

Nhá»¯ng thay Ä‘á»•i nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n Ä‘á»ƒ cáº£i thiá»‡n viá»‡c sá»­ dá»¥ng bá»™ nhá»› vÃ  tÄƒng tÃ­nh nháº¥t quÃ¡n vá»›i cÃ¡c tráº¡ng thÃ¡i loading qua cÃ¡c lá»i gá»i cá»§a `useAsyncData`.

#### BÆ°á»›c di chuyá»ƒn

1. **Kiá»ƒm tra cÃ¡c tÃ¹y chá»n khÃ´ng nháº¥t quÃ¡n**: Xem láº¡i báº¥t ká»³ component nÃ o sá»­ dá»¥ng cÃ¹ng key vá»›i cÃ¡c tÃ¹y chá»n hoáº·c fetch functions khÃ¡c nhau.

   ```ts
   // Äiá»u nÃ y giá» Ä‘Ã¢y sáº½ kÃ­ch hoáº¡t cáº£nh bÃ¡o
   const { data: users1 } = useAsyncData('users', () => $fetch('/api/users'), { deep: false })
   const { data: users2 } = useAsyncData('users', () => $fetch('/api/users'), { deep: true })
   ```

   CÃ³ thá»ƒ cÃ³ lá»£i khi trÃ­ch xuáº¥t báº¥t ká»³ lá»i gá»i nÃ o Ä‘áº¿n `useAsyncData` chia sáº» key rÃµ rÃ ng (vÃ  cÃ³ tÃ¹y chá»n tÃ¹y chá»‰nh) vÃ o composable riÃªng cá»§a chÃºng:

   ```ts [composables/useUserData.ts]
   export function useUserData(userId: string) {
     return useAsyncData(
       `user-${userId}`,
       () => fetchUser(userId),
       { 
         deep: true,
         transform: (user) => ({ ...user, lastAccessed: new Date() })
       }
     )
   }
   ```

2. **Cáº­p nháº­t cÃ¡c implementations cá»§a `getCachedData`**:

   ```diff
   useAsyncData('key', fetchFunction, {
   -  getCachedData: (key, nuxtApp) => {
   -    return cachedData[key]
   -  }
   +  getCachedData: (key, nuxtApp, ctx) => {
   +    // ctx.cause - cÃ³ thá»ƒ lÃ  'initial' | 'refresh:hook' | 'refresh:manual' | 'watch'
   +    
   +    // VÃ­ dá»¥: KhÃ´ng sá»­ dá»¥ng cache khi refresh thá»§ cÃ´ng
   +    if (ctx.cause === 'refresh:manual') return undefined
   +    
   +    return cachedData[key]
   +  }
   })
   ```

Thay vÃ o Ä‘Ã³, hiá»‡n táº¡i, báº¡n cÃ³ thá»ƒ táº¯t hÃ nh vi nÃ y vá»›i:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    granularCachedData: false,
    purgeCachedData: false
  }
})
```

### Thá»© tá»± táº£i Module Ä‘Æ°á»£c sá»­a chá»¯a trong Layers

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Thá»© tá»± mÃ  cÃ¡c modules Ä‘Æ°á»£c táº£i khi sá»­ dá»¥ng [Nuxt layers](/docs/guide/going-further/layers) Ä‘Ã£ Ä‘Æ°á»£c sá»­a chá»¯a. TrÆ°á»›c Ä‘Ã¢y, cÃ¡c modules tá»« project root Ä‘Æ°á»£c táº£i trÆ°á»›c cÃ¡c modules tá»« extended layers, Ä‘iá»u nÃ y ngÆ°á»£c láº¡i vá»›i hÃ nh vi mong Ä‘á»£i.

Giá» Ä‘Ã¢y cÃ¡c modules Ä‘Æ°á»£c táº£i theo thá»© tá»± Ä‘Ãºng:

1. **Layer modules trÆ°á»›c** (theo thá»© tá»± extend - deeper layers trÆ°á»›c)
2. **Project modules cuá»‘i** (Æ°u tiÃªn cao nháº¥t)

Äiá»u nÃ y áº£nh hÆ°á»Ÿng Ä‘áº¿n cáº£:
* CÃ¡c modules Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong máº£ng `modules` trong `nuxt.config.ts`
* CÃ¡c modules Ä‘Æ°á»£c tá»± Ä‘á»™ng khÃ¡m phÃ¡ tá»« thÆ° má»¥c `modules/`

#### LÃ½ do thay Ä‘á»•i

Thay Ä‘á»•i nÃ y Ä‘áº£m báº£o ráº±ng:
* CÃ¡c extended layers cÃ³ Æ°u tiÃªn tháº¥p hÆ¡n dá»± Ã¡n tiÃªu thá»¥
* Thá»© tá»± thá»±c thi module phÃ¹ há»£p vá»›i mÃ´ hÃ¬nh káº¿ thá»«a layer trá»±c quan
* Cáº¥u hÃ¬nh module vÃ  hooks hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i trong cÃ¡c thiáº¿t láº­p Ä‘a layer

#### BÆ°á»›c di chuyá»ƒn

**Háº§u háº¿t cÃ¡c dá»± Ã¡n sáº½ khÃ´ng cáº§n thay Ä‘á»•i**, vÃ¬ Ä‘iá»u nÃ y sá»­a chá»¯a thá»© tá»± táº£i Ä‘á»ƒ phÃ¹ há»£p vá»›i hÃ nh vi mong Ä‘á»£i.

Tuy nhiÃªn, náº¿u dá»± Ã¡n cá»§a báº¡n Ä‘Ã£ dá»±a vÃ o thá»© tá»± khÃ´ng Ä‘Ãºng trÆ°á»›c Ä‘Ã¢y, báº¡n cÃ³ thá»ƒ cáº§n:

1. **Xem láº¡i cÃ¡c dependencies cá»§a module**: Kiá»ƒm tra xem cÃ³ modules nÃ o phá»¥ thuá»™c vÃ o thá»© tá»± táº£i cá»¥ thá»ƒ khÃ´ng
2. **Äiá»u chá»‰nh cáº¥u hÃ¬nh module**: Náº¿u cÃ¡c modules Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ lÃ m viá»‡c xung quanh thá»© tá»± khÃ´ng Ä‘Ãºng
3. **Kiá»ƒm tra ká»¹ lÆ°á»¡ng**: Äáº£m báº£o táº¥t cáº£ chá»©c nÄƒng hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i vá»›i thá»© tá»± Ä‘Æ°á»£c sá»­a chá»¯a

VÃ­ dá»¥ vá» thá»© tá»± Ä‘Ãºng má»›i:
```ts
// Layer: my-layer/nuxt.config.ts
export default defineNuxtConfig({
  modules: ['layer-module-1', 'layer-module-2']
})

// Project: nuxt.config.ts
export default defineNuxtConfig({
  extends: ['./my-layer'],
  modules: ['project-module-1', 'project-module-2']
})

// Thá»© tá»± táº£i (Ä‘Ã£ sá»­a chá»¯a):
// 1. layer-module-1
// 2. layer-module-2  
// 3. project-module-1 (cÃ³ thá»ƒ ghi Ä‘Ã¨ layer modules)
// 4. project-module-2 (cÃ³ thá»ƒ ghi Ä‘Ã¨ layer modules)
```

Náº¿u báº¡n gáº·p váº¥n Ä‘á» vá»›i cÃ¡c dependencies thá»© tá»± module do cáº§n Ä‘Äƒng kÃ½ má»™t hook, hÃ£y xem xÃ©t sá»­ dá»¥ng [`modules:done` hook](/docs/guide/going-further/modules#custom-hooks) cho cÃ¡c modules cáº§n gá»i má»™t hook. Hook nÃ y Ä‘Æ°á»£c cháº¡y sau khi táº¥t cáº£ cÃ¡c modules khÃ¡c Ä‘Ã£ Ä‘Æ°á»£c táº£i, cÃ³ nghÄ©a lÃ  viá»‡c sá»­ dá»¥ng nÃ³ lÃ  an toÃ n.

ğŸ‘‰ Xem [PR #31507](https://github.com/nuxt/nuxt/pull/31507) vÃ  [issue #25719](https://github.com/nuxt/nuxt/issues/25719) Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.

### Khá»­ trÃ¹ng Route Metadata

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

CÃ³ thá»ƒ thiáº¿t láº­p má»™t sá»‘ metadata route báº±ng `definePageMeta`, cháº³ng háº¡n nhÆ° `name`, `path`, v.v. TrÆ°á»›c Ä‘Ã¢y chÃºng cÃ³ sáºµn cáº£ trÃªn route vÃ  trÃªn route metadata (vÃ­ dá»¥, `route.name` vÃ  `route.meta.name`).

Giá» Ä‘Ã¢y, chÃºng chá»‰ cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c trÃªn Ä‘á»‘i tÆ°á»£ng route.

#### LÃ½ do thay Ä‘á»•i

ÄÃ¢y lÃ  káº¿t quáº£ cá»§a viá»‡c kÃ­ch hoáº¡t `experimental.scanPageMeta` theo máº·c Ä‘á»‹nh, vÃ  lÃ  má»™t tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t.

#### BÆ°á»›c di chuyá»ƒn

Viá»‡c di chuyá»ƒn nÃªn Ä‘Æ¡n giáº£n:

```diff
  const route = useRoute()
  
- console.log(route.meta.name)
+ console.log(route.name)
```

### TÃªn Component Ä‘Æ°á»£c chuáº©n hÃ³a

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Vá»«a pháº£i

Vue giá» Ä‘Ã¢y sáº½ táº¡o ra cÃ¡c tÃªn component phÃ¹ há»£p vá»›i mÃ´ hÃ¬nh Nuxt cho viá»‡c Ä‘áº·t tÃªn component.

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Theo máº·c Ä‘á»‹nh, náº¿u báº¡n chÆ°a thiáº¿t láº­p nÃ³ thá»§ cÃ´ng, Vue sáº½ gÃ¡n má»™t tÃªn component phÃ¹ há»£p vá»›i tÃªn tá»‡p cá»§a component.

```bash [Directory structure]
â”œâ”€ components/
â”œâ”€â”€ SomeFolder/
â”œâ”€â”€â”€â”€ MyComponent.vue
```

Trong trÆ°á»ng há»£p nÃ y, tÃªn component sáº½ lÃ  `MyComponent`, theo nhÆ° Vue quan tÃ¢m. Náº¿u báº¡n muá»‘n sá»­ dá»¥ng `<KeepAlive>` vá»›i nÃ³, hoáº·c xÃ¡c Ä‘á»‹nh nÃ³ trong Vue DevTools, báº¡n sáº½ cáº§n sá»­ dá»¥ng tÃªn nÃ y.

NhÆ°ng Ä‘á»ƒ auto-import nÃ³, báº¡n sáº½ cáº§n sá»­ dá»¥ng `SomeFolderMyComponent`.

Vá»›i thay Ä‘á»•i nÃ y, hai giÃ¡ trá»‹ nÃ y sáº½ khá»›p, vÃ  Vue sáº½ táº¡o ra má»™t tÃªn component phÃ¹ há»£p vá»›i mÃ´ hÃ¬nh Nuxt cho viá»‡c Ä‘áº·t tÃªn component.

#### BÆ°á»›c di chuyá»ƒn

Äáº£m báº£o ráº±ng báº¡n sá»­ dá»¥ng tÃªn Ä‘Ã£ cáº­p nháº­t trong báº¥t ká»³ bÃ i test nÃ o sá»­ dá»¥ng `findComponent` tá»« `@vue/test-utils` vÃ  trong báº¥t ká»³ `<KeepAlive>` nÃ o phá»¥ thuá»™c vÃ o tÃªn cá»§a component.

Thay vÃ o Ä‘Ã³, hiá»‡n táº¡i, báº¡n cÃ³ thá»ƒ táº¯t hÃ nh vi nÃ y vá»›i:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    normalizeComponentNames: false
  }
})
```

### Unhead v2

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

[Unhead](https://unhead.unjs.io/), Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o cÃ¡c tháº» `<head>`, Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t lÃªn phiÃªn báº£n 2. Máº·c dÃ¹ chá»§ yáº¿u tÆ°Æ¡ng thÃ­ch nhÆ°ng nÃ³ bao gá»“m má»™t sá»‘ thay Ä‘á»•i phÃ¡ vá»¡ cho cÃ¡c API cáº¥p tháº¥p hÆ¡n.

* CÃ¡c props Ä‘Ã£ loáº¡i bá»: `vmid`, `hid`, `children`, `body`.
* Promise input khÃ´ng cÃ²n Ä‘Æ°á»£c há»— trá»£.
* CÃ¡c tháº» giá» Ä‘Ã¢y Ä‘Æ°á»£c sáº¯p xáº¿p báº±ng Capo.js theo máº·c Ä‘á»‹nh.

#### BÆ°á»›c di chuyá»ƒn

CÃ¡c thay Ä‘á»•i trÃªn nÃªn cÃ³ tÃ¡c Ä‘á»™ng tá»‘i thiá»ƒu Ä‘áº¿n á»©ng dá»¥ng cá»§a báº¡n.

Náº¿u báº¡n cÃ³ váº¥n Ä‘á», báº¡n nÃªn xÃ¡c minh:

* Báº¡n khÃ´ng sá»­ dá»¥ng báº¥t ká»³ props nÃ o Ä‘Ã£ bá»‹ loáº¡i bá».

```diff
useHead({
  meta: [{ 
    name: 'description', 
    // meta tags khÃ´ng cáº§n vmid, hoáº·c key    
-   vmid: 'description' 
-   hid: 'description'
  }]
})
```

* Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng [Template Params](https://unhead.unjs.io/docs/head/guides/plugins/template-params) hoáº·c [Alias Tag Sorting](https://unhead.unjs.io/docs/head/guides/plugins/alias-sorting), báº¡n sáº½ cáº§n rÃµ rÃ ng opt in vÃ o cÃ¡c tÃ­nh nÄƒng nÃ y ngay bÃ¢y giá».

```ts
import { TemplateParamsPlugin, AliasSortingPlugin } from '@unhead/vue/plugins'

export default defineNuxtPlugin({
  setup() {
    const unhead = injectHead()
    unhead.use(TemplateParamsPlugin)
    unhead.use(AliasSortingPlugin)
  }
})
```

Máº·c dÃ¹ khÃ´ng báº¯t buá»™c, nhÆ°ng Ä‘Æ°á»£c khuyáº¿n nghá»‹ cáº­p nháº­t báº¥t ká»³ imports nÃ o tá»« `@unhead/vue` sang `#imports` hoáº·c `nuxt/app`.

```diff
-import { useHead } from '@unhead/vue'
+import { useHead } from '#imports'
```

Náº¿u báº¡n váº«n cÃ³ váº¥n Ä‘á», báº¡n cÃ³ thá»ƒ hoÃ n nguyÃªn vá» hÃ nh vi v1 báº±ng cÃ¡ch kÃ­ch hoáº¡t cáº¥u hÃ¬nh `head.legacy`.

```ts
export default defineNuxtConfig({
  unhead: {
    legacy: true,
  }
})
```

### Vá»‹ trÃ­ DOM má»›i cho SPA Loading Screen

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Khi render má»™t trang chá»‰ dÃ nh cho client (vá»›i `ssr: false`), chÃºng tÃ´i tÃ¹y Ã½ render má»™t mÃ n hÃ¬nh loading (tá»« `~/app/spa-loading-template.html` - lÆ°u Ã½ ráº±ng Ä‘iá»u nÃ y cÅ©ng Ä‘Ã£ thay Ä‘á»•i thÃ nh `~/spa-loading-template.html` trong Nuxt 4), bÃªn trong Nuxt app root:

```html
<div id="__nuxt">
  <!-- spa loading template -->
</div>
```

Giá» Ä‘Ã¢y, chÃºng tÃ´i máº·c Ä‘á»‹nh render template cÃ¹ng vá»›i Nuxt app root:

```html
<div id="__nuxt"></div>
<!-- spa loading template -->
```

#### LÃ½ do thay Ä‘á»•i

Äiá»u nÃ y cho phÃ©p spa loading template váº«n cÃ²n trong DOM cho Ä‘áº¿n khi Vue app suspense resolves, ngÄƒn cháº·n flash mÃ u tráº¯ng.

#### BÆ°á»›c di chuyá»ƒn

Náº¿u báº¡n Ä‘ang nháº¯m má»¥c tiÃªu spa loading template vá»›i CSS hoáº·c `document.queryElement`, báº¡n sáº½ cáº§n cáº­p nháº­t cÃ¡c selectors cá»§a mÃ¬nh. Cho má»¥c Ä‘Ã­ch nÃ y, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tÃ¹y chá»n cáº¥u hÃ¬nh má»›i `app.spaLoaderTag` vÃ  `app.spaLoaderAttrs`.

Thay vÃ o Ä‘Ã³, báº¡n cÃ³ thá»ƒ hoÃ n nguyÃªn vá» hÃ nh vi trÆ°á»›c Ä‘Ã¢y vá»›i:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    spaLoadingTemplateLocation: 'within',
  }
})
```

### `error.data` Ä‘Æ°á»£c Parse

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

CÃ³ thá»ƒ throw má»™t error vá»›i thuá»™c tÃ­nh `data`, nhÆ°ng Ä‘iá»u nÃ y khÃ´ng Ä‘Æ°á»£c parsed. Giá» Ä‘Ã¢y, nÃ³ Ä‘Æ°á»£c parsed vÃ  cÃ³ sáºµn trong Ä‘á»‘i tÆ°á»£ng `error`. Máº·c dÃ¹ lÃ  má»™t báº£n sá»­a lá»—i, nhÆ°ng vá» máº·t ká»¹ thuáº­t Ä‘Ã¢y lÃ  má»™t thay Ä‘á»•i phÃ¡ vá»¡ náº¿u báº¡n Ä‘Ã£ dá»±a vÃ o hÃ nh vi trÆ°á»›c Ä‘Ã¢y vÃ  tá»± parse nÃ³.

#### BÆ°á»›c di chuyá»ƒn

Cáº­p nháº­t `error.vue` tÃ¹y chá»‰nh cá»§a báº¡n Ä‘á»ƒ loáº¡i bá» báº¥t ká»³ parsing bá»• sung nÃ o cá»§a `error.data`:

```diff
  <script setup lang="ts">
  import type { NuxtError } from '#app'

  const props = defineProps({
    error: Object as () => NuxtError
  })

- const data = JSON.parse(error.data)
+ const data = error.data
  </script>
```

### Inline Styles chi tiáº¿t hÆ¡n

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Vá»«a pháº£i

Nuxt giá» Ä‘Ã¢y sáº½ chá»‰ inline styles cho cÃ¡c Vue components, khÃ´ng pháº£i CSS toÃ n cá»¥c.

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

TrÆ°á»›c Ä‘Ã¢y, Nuxt sáº½ inline táº¥t cáº£ CSS, bao gá»“m global styles, vÃ  loáº¡i bá» cÃ¡c pháº§n tá»­ `<link>` Ä‘áº¿n cÃ¡c tá»‡p CSS riÃªng biá»‡t. Giá» Ä‘Ã¢y, Nuxt sáº½ chá»‰ lÃ m Ä‘iá»u nÃ y cho cÃ¡c Vue components (trÆ°á»›c Ä‘Ã¢y táº¡o ra cÃ¡c chunks CSS riÃªng biá»‡t). ChÃºng tÃ´i nghÄ© Ä‘Ã¢y lÃ  sá»± cÃ¢n báº±ng tá»‘t hÆ¡n trong viá»‡c giáº£m cÃ¡c yÃªu cáº§u máº¡ng riÃªng biá»‡t (giá»‘ng nhÆ° trÆ°á»›c Ä‘Ã¢y, sáº½ khÃ´ng cÃ³ cÃ¡c yÃªu cáº§u riÃªng biá»‡t cho cÃ¡c tá»‡p `.css` riÃªng láº» theo tá»«ng trang hoáº·c tá»«ng component khi táº£i ban Ä‘áº§u), cÅ©ng nhÆ° cho phÃ©p caching cá»§a má»™t tá»‡p CSS toÃ n cá»¥c duy nháº¥t vÃ  giáº£m kÃ­ch thÆ°á»›c táº£i xuá»‘ng document cá»§a yÃªu cáº§u ban Ä‘áº§u.

#### BÆ°á»›c di chuyá»ƒn

TÃ­nh nÄƒng nÃ y cÃ³ thá»ƒ cáº¥u hÃ¬nh Ä‘áº§y Ä‘á»§ vÃ  báº¡n cÃ³ thá»ƒ hoÃ n nguyÃªn vá» hÃ nh vi trÆ°á»›c Ä‘Ã¢y báº±ng cÃ¡ch thiáº¿t láº­p `inlineStyles: true` Ä‘á»ƒ inline global CSS cÅ©ng nhÆ° per-component CSS.

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  features: {
    inlineStyles: true
  }
})
```

### QuÃ©t Page Meta sau Resolution

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

ChÃºng tÃ´i giá» Ä‘Ã¢y quÃ©t page metadata (Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `definePageMeta`) _sau khi_ gá»i hook `pages:extend` thay vÃ¬ trÆ°á»›c Ä‘Ã³.

#### LÃ½ do thay Ä‘á»•i

Äiá»u nÃ y nháº±m cho phÃ©p quÃ©t metadata cho cÃ¡c pages mÃ  ngÆ°á»i dÃ¹ng muá»‘n thÃªm vÃ o trong `pages:extend`. ChÃºng tÃ´i váº«n cung cáº¥p cÆ¡ há»™i thay Ä‘á»•i hoáº·c ghi Ä‘Ã¨ page metadata trong má»™t hook `pages:resolved` má»›i.

#### BÆ°á»›c di chuyá»ƒn

Náº¿u báº¡n muá»‘n ghi Ä‘Ã¨ page metadata, hÃ£y lÃ m Ä‘iá»u Ä‘Ã³ trong `pages:resolved` thay vÃ¬ trong `pages:extend`.

```diff
  export default defineNuxtConfig({
    hooks: {
-     'pages:extend'(pages) {
+     'pages:resolved'(pages) {
        const myPage = pages.find(page => page.path === '/')
        myPage.meta ||= {}
        myPage.meta.layout = 'overridden-layout'
      }
    }
  })
```

Thay vÃ o Ä‘Ã³, báº¡n cÃ³ thá»ƒ hoÃ n nguyÃªn vá» hÃ nh vi trÆ°á»›c Ä‘Ã¢y vá»›i:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    scanPageMeta: true
  }
})
```

### Chia sáº» Prerender Data

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Trung bÃ¬nh

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

ChÃºng tÃ´i Ä‘Ã£ kÃ­ch hoáº¡t má»™t tÃ­nh nÄƒng thá»­ nghiá»‡m trÆ°á»›c Ä‘Ã¢y Ä‘á»ƒ chia sáº» dá»¯ liá»‡u tá»« cÃ¡c lá»i gá»i `useAsyncData` vÃ  `useFetch`, qua cÃ¡c pages khÃ¡c nhau. Xem [PR gá»‘c](https://github.com/nuxt/nuxt/pull/24894).

#### LÃ½ do thay Ä‘á»•i

TÃ­nh nÄƒng nÃ y tá»± Ä‘á»™ng chia sáº» payload _data_ giá»¯a cÃ¡c pages Ä‘Æ°á»£c prerender. Äiá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n cáº£i thiá»‡n hiá»‡u suáº¥t Ä‘Ã¡ng ká»ƒ khi prerender cÃ¡c sites sá»­ dá»¥ng `useAsyncData` hoáº·c `useFetch` vÃ  fetch cÃ¹ng dá»¯ liá»‡u trong cÃ¡c pages khÃ¡c nhau.

VÃ­ dá»¥, náº¿u site cá»§a báº¡n yÃªu cáº§u lá»i gá»i `useFetch` cho má»i page (vÃ­ dá»¥, Ä‘á»ƒ láº¥y dá»¯ liá»‡u Ä‘iá»u hÆ°á»›ng cho menu, hoáº·c cÃ i Ä‘áº·t site tá»« CMS), dá»¯ liá»‡u nÃ y sáº½ chá»‰ Ä‘Æ°á»£c láº¥y má»™t láº§n khi prerender page Ä‘áº§u tiÃªn sá»­ dá»¥ng nÃ³, vÃ  sau Ä‘Ã³ Ä‘Æ°á»£c cached Ä‘á»ƒ sá»­ dá»¥ng khi prerender cÃ¡c pages khÃ¡c.

#### BÆ°á»›c di chuyá»ƒn

Äáº£m báº£o ráº±ng báº¥t ká»³ key duy nháº¥t nÃ o cá»§a dá»¯ liá»‡u cá»§a báº¡n luÃ´n cÃ³ thá»ƒ resolve thÃ nh cÃ¹ng dá»¯ liá»‡u. VÃ­ dá»¥, náº¿u báº¡n Ä‘ang sá»­ dá»¥ng `useAsyncData` Ä‘á»ƒ fetch dá»¯ liá»‡u liÃªn quan Ä‘áº¿n má»™t page cá»¥ thá»ƒ, báº¡n nÃªn cung cáº¥p key phÃ¹ há»£p duy nháº¥t vá»›i dá»¯ liá»‡u Ä‘Ã³. (`useFetch` nÃªn lÃ m Ä‘iá»u nÃ y tá»± Ä‘á»™ng cho báº¡n.)

```ts [app/pages/test/[slug\].vue]
// Äiá»u nÃ y sáº½ khÃ´ng an toÃ n trong má»™t dynamic page (vÃ­ dá»¥ `[slug].vue`) vÃ¬ route slug táº¡o ra sá»± khÃ¡c biá»‡t
// vá»›i dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y, nhÆ°ng Nuxt khÃ´ng thá»ƒ biáº¿t Ä‘iá»u Ä‘Ã³ vÃ¬ nÃ³ khÃ´ng Ä‘Æ°á»£c pháº£n Ã¡nh trong key.
const route = useRoute()
const { data } = await useAsyncData(async () => {
  return await $fetch(`/api/my-page/${route.params.slug}`)
})
// Thay vÃ o Ä‘Ã³, báº¡n nÃªn sá»­ dá»¥ng key xÃ¡c Ä‘á»‹nh duy nháº¥t dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y.
const { data } = await useAsyncData(route.params.slug, async () => {
  return await $fetch(`/api/my-page/${route.params.slug}`)
})
```

Thay vÃ o Ä‘Ã³, báº¡n cÃ³ thá»ƒ táº¯t tÃ­nh nÄƒng nÃ y vá»›i:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    sharedPrerenderData: false
  }
})
```

### GiÃ¡ trá»‹ `data` vÃ  `error` máº·c Ä‘á»‹nh trong `useAsyncData` vÃ  `useFetch`

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

CÃ¡c Ä‘á»‘i tÆ°á»£ng `data` vÃ  `error` Ä‘Æ°á»£c tráº£ vá» tá»« `useAsyncData` giá» Ä‘Ã¢y sáº½ máº·c Ä‘á»‹nh lÃ  `undefined`.

#### LÃ½ do thay Ä‘á»•i

TrÆ°á»›c Ä‘Ã¢y `data` Ä‘Æ°á»£c khá»Ÿi táº¡o thÃ nh `null` nhÆ°ng Ä‘Æ°á»£c reset trong `clearNuxtData` thÃ nh `undefined`. `error` Ä‘Æ°á»£c khá»Ÿi táº¡o thÃ nh `null`. Thay Ä‘á»•i nÃ y nháº±m mang láº¡i tÃ­nh nháº¥t quÃ¡n cao hÆ¡n.

#### BÆ°á»›c di chuyá»ƒn

Náº¿u báº¡n Ä‘ang kiá»ƒm tra xem `data.value` hoáº·c `error.value` cÃ³ pháº£i `null` khÃ´ng, báº¡n cÃ³ thá»ƒ cáº­p nháº­t cÃ¡c kiá»ƒm tra nÃ y Ä‘á»ƒ kiá»ƒm tra `undefined` thay tháº¿.

::tip
Báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng hÃ³a bÆ°á»›c nÃ y báº±ng cÃ¡ch cháº¡y `npx codemod@latest nuxt/4/default-data-error-value`
::

Náº¿u báº¡n gáº·p báº¥t ká»³ váº¥n Ä‘á» nÃ o, báº¡n cÃ³ thá»ƒ hoÃ n nguyÃªn vá» hÃ nh vi trÆ°á»›c Ä‘Ã¢y vá»›i:

```ts twoslash [nuxt.config.ts]
// @errors: 2353
export default defineNuxtConfig({
  experimental: {
    defaults: {
      useAsyncData: {
        value: 'null',
        errorValue: 'null'
      }
    }
  }
})
```

Vui lÃ²ng bÃ¡o cÃ¡o issue náº¿u báº¡n lÃ m Ä‘iá»u nÃ y, vÃ¬ chÃºng tÃ´i khÃ´ng cÃ³ káº¿ hoáº¡ch giá»¯ Ä‘iá»u nÃ y cÃ³ thá»ƒ cáº¥u hÃ¬nh.

### Loáº¡i bá» cÃ¡c giÃ¡ trá»‹ `boolean` deprecated cho tÃ¹y chá»n `dedupe` khi gá»i `refresh` trong `useAsyncData` vÃ  `useFetch`

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

TrÆ°á»›c Ä‘Ã¢y cÃ³ thá»ƒ truyá»n `dedupe: boolean` Ä‘áº¿n `refresh`. ÄÃ¢y lÃ  cÃ¡c aliases cá»§a `cancel` (`true`) vÃ  `defer` (`false`).

```ts twoslash [app.vue]
// @errors: 2322
const { refresh } = await useAsyncData(async () => ({ message: 'Hello, Nuxt!' }))

async function refreshData () {
  await refresh({ dedupe: true })
}
```

#### LÃ½ do thay Ä‘á»•i

Nhá»¯ng aliases nÃ y Ä‘Ã£ Ä‘Æ°á»£c loáº¡i bá», Ä‘á»ƒ cÃ³ sá»± rÃµ rÃ ng hÆ¡n.

Váº¥n Ä‘á» náº£y sinh khi thÃªm `dedupe` nhÆ° má»™t tÃ¹y chá»n vÃ o `useAsyncData`, vÃ  chÃºng tÃ´i Ä‘Ã£ loáº¡i bá» cÃ¡c giÃ¡ trá»‹ boolean vÃ¬ chÃºng káº¿t thÃºc lÃ  _Ä‘á»‘i láº­p_.

`refresh({ dedupe: false })` cÃ³ nghÄ©a lÃ  **khÃ´ng _há»§y_ cÃ¡c yÃªu cáº§u hiá»‡n cÃ³ Ä‘á»ƒ Æ°u tiÃªn cÃ¡i má»›i nÃ y**. NhÆ°ng viá»‡c truyá»n `dedupe: true` trong tÃ¹y chá»n cá»§a `useAsyncData` cÃ³ nghÄ©a lÃ  **khÃ´ng thá»±c hiá»‡n báº¥t ká»³ yÃªu cáº§u má»›i nÃ o náº¿u cÃ³ yÃªu cáº§u Ä‘ang chá» hiá»‡n táº¡i.** (Xem [PR](https://github.com/nuxt/nuxt/pull/24564#pullrequestreview-1764584361).)

#### BÆ°á»›c di chuyá»ƒn

Viá»‡c di chuyá»ƒn nÃªn Ä‘Æ¡n giáº£n:

```diff
  const { refresh } = await useAsyncData(async () => ({ message: 'Hello, Nuxt 3!' }))
  
  async function refreshData () {
-   await refresh({ dedupe: true })
+   await refresh({ dedupe: 'cancel' })

-   await refresh({ dedupe: false })
+   await refresh({ dedupe: 'defer' })
  }
```

::tip
Báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng hÃ³a bÆ°á»›c nÃ y báº±ng cÃ¡ch cháº¡y `npx codemod@latest nuxt/4/deprecated-dedupe-value`
::

### TÃ´n trá»ng defaults khi xÃ³a `data` trong `useAsyncData` vÃ  `useFetch`

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Náº¿u báº¡n cung cáº¥p giÃ¡ trá»‹ `default` tÃ¹y chá»‰nh cho `useAsyncData`, giá» Ä‘Ã¢y giÃ¡ trá»‹ nÃ y sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng khi gá»i `clear` hoáº·c `clearNuxtData` vÃ  nÃ³ sáº½ Ä‘Æ°á»£c reset vá» giÃ¡ trá»‹ máº·c Ä‘á»‹nh thay vÃ¬ Ä‘Æ¡n giáº£n bá» thiáº¿t láº­p.

#### LÃ½ do thay Ä‘á»•i

ThÆ°á»ng ngÆ°á»i dÃ¹ng thiáº¿t láº­p má»™t giÃ¡ trá»‹ trá»‘ng phÃ¹ há»£p, cháº³ng háº¡n nhÆ° máº£ng trá»‘ng, Ä‘á»ƒ trÃ¡nh cáº§n kiá»ƒm tra `null`/`undefined` khi láº·p qua nÃ³. Äiá»u nÃ y nÃªn Ä‘Æ°á»£c tÃ´n trá»ng khi reset/xÃ³a dá»¯ liá»‡u.

### CÄƒn chá»‰nh giÃ¡ trá»‹ `pending` trong `useAsyncData` vÃ  `useFetch`

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Trung bÃ¬nh

Äá»‘i tÆ°á»£ng `pending` Ä‘Æ°á»£c tráº£ vá» tá»« `useAsyncData`, `useFetch`, `useLazyAsyncData` vÃ  `useLazyFetch` giá» Ä‘Ã¢y lÃ  má»™t computed property chá»‰ `true` khi `status` cÅ©ng Ä‘ang pending.

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Giá» Ä‘Ã¢y, khi `immediate: false` Ä‘Æ°á»£c truyá»n, `pending` sáº½ lÃ  `false` cho Ä‘áº¿n khi yÃªu cáº§u Ä‘áº§u tiÃªn Ä‘Æ°á»£c thá»±c hiá»‡n. ÄÃ¢y lÃ  sá»± thay Ä‘á»•i tá»« hÃ nh vi trÆ°á»›c Ä‘Ã¢y, khi `pending` luÃ´n lÃ  `true` cho Ä‘áº¿n khi yÃªu cáº§u Ä‘áº§u tiÃªn Ä‘Æ°á»£c thá»±c hiá»‡n.

#### LÃ½ do thay Ä‘á»•i

Äiá»u nÃ y cÄƒn chá»‰nh Ã½ nghÄ©a cá»§a `pending` vá»›i thuá»™c tÃ­nh `status`, cÅ©ng lÃ  `pending` khi yÃªu cáº§u Ä‘ang trong quÃ¡ trÃ¬nh thá»±c hiá»‡n.

#### BÆ°á»›c di chuyá»ƒn

Náº¿u báº¡n dá»±a vÃ o thuá»™c tÃ­nh `pending`, hÃ£y Ä‘áº£m báº£o logic cá»§a báº¡n tÃ­nh Ä‘áº¿n hÃ nh vi má»›i khi `pending` sáº½ chá»‰ lÃ  `true` khi status cÅ©ng Ä‘ang pending.

```diff
  <template>
-   <div v-if="!pending">
+   <div v-if="status === 'success'">
      <p>Data: {{ data }}</p>
    </div>
    <div v-else>
      <p>Loading...</p>
    </div>
  </template>
  <script setup lang="ts">
  const { data, pending, execute, status } = await useAsyncData(() => fetch('/api/data'), {
    immediate: false
  })
  onMounted(() => execute())
  </script>
```

Thay vÃ o Ä‘Ã³, báº¡n cÃ³ thá»ƒ táº¡m thá»i hoÃ n nguyÃªn vá» hÃ nh vi trÆ°á»›c Ä‘Ã¢y vá»›i:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    pendingWhenIdle: true
  }
})
```

### HÃ nh vi thay Ä‘á»•i Key trong `useAsyncData` vÃ  `useFetch`

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Trung bÃ¬nh

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Khi sá»­ dá»¥ng reactive keys trong `useAsyncData` hoáº·c `useFetch`, Nuxt tá»± Ä‘á»™ng refetch dá»¯ liá»‡u khi key thay Ä‘á»•i. Khi `immediate: false` Ä‘Æ°á»£c thiáº¿t láº­p, `useAsyncData` sáº½ chá»‰ fetch dá»¯ liá»‡u khi key thay Ä‘á»•i náº¿u dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c fetch má»™t láº§n.

TrÆ°á»›c Ä‘Ã¢y, `useFetch` cÃ³ hÃ nh vi hÆ¡i khÃ¡c. NÃ³ sáº½ luÃ´n fetch dá»¯ liá»‡u khi key thay Ä‘á»•i.

Giá» Ä‘Ã¢y, `useFetch` vÃ  `useAsyncData` hÃ nh xá»­ nháº¥t quÃ¡n - báº±ng cÃ¡ch chá»‰ fetch dá»¯ liá»‡u khi key thay Ä‘á»•i náº¿u dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c fetch má»™t láº§n.

#### LÃ½ do thay Ä‘á»•i

Äiá»u nÃ y Ä‘áº£m báº£o hÃ nh vi nháº¥t quÃ¡n giá»¯a `useAsyncData` vÃ  `useFetch`, vÃ  ngÄƒn cháº·n cÃ¡c fetches khÃ´ng mong muá»‘n. Náº¿u báº¡n Ä‘Ã£ thiáº¿t láº­p `immediate: false`, thÃ¬ báº¡n pháº£i gá»i `refresh` hoáº·c `execute` hoáº·c dá»¯ liá»‡u sáº½ khÃ´ng bao giá» Ä‘Æ°á»£c fetch trong `useFetch` hoáº·c `useAsyncData`.

#### BÆ°á»›c di chuyá»ƒn

Thay Ä‘á»•i nÃ y nÃ³i chung nÃªn cáº£i thiá»‡n hÃ nh vi mong Ä‘á»£i, nhÆ°ng náº¿u báº¡n mong Ä‘á»£i viá»‡c thay Ä‘á»•i key hoáº·c options cá»§a má»™t `useFetch` khÃ´ng immediate, giá» Ä‘Ã¢y báº¡n sáº½ cáº§n kÃ­ch hoáº¡t nÃ³ thá»§ cÃ´ng láº§n Ä‘áº§u tiÃªn.

```diff
  const id = ref('123')
  const { data, execute } = await useFetch('/api/test', {
    query: { id },
    immediate: false
  )
+ watch(id, () => execute(), { once: true })
```

Äá»ƒ opt out khá»i hÃ nh vi nÃ y:

```ts
// Hoáº·c toÃ n cá»¥c trong Nuxt config cá»§a báº¡n
export default defineNuxtConfig({
  experimental: {
    alwaysRunFetchOnKeyChange: true
  }
})
```

### Shallow Data Reactivity trong `useAsyncData` vÃ  `useFetch`

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

Äá»‘i tÆ°á»£ng `data` Ä‘Æ°á»£c tráº£ vá» tá»« `useAsyncData`, `useFetch`, `useLazyAsyncData` vÃ  `useLazyFetch` giá» Ä‘Ã¢y lÃ  má»™t `shallowRef` thay vÃ¬ má»™t `ref`.

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Khi dá»¯ liá»‡u má»›i Ä‘Æ°á»£c fetch, báº¥t cá»© thá»© gÃ¬ phá»¥ thuá»™c vÃ o `data` váº«n sáº½ lÃ  reactive vÃ¬ toÃ n bá»™ Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c thay tháº¿. NhÆ°ng náº¿u mÃ£ cá»§a báº¡n thay Ä‘á»•i má»™t thuá»™c tÃ­nh _trong_ cáº¥u trÃºc dá»¯ liá»‡u Ä‘Ã³, Ä‘iá»u nÃ y sáº½ khÃ´ng kÃ­ch hoáº¡t báº¥t ká»³ reactivity nÃ o trong á»©ng dá»¥ng cá»§a báº¡n.

#### LÃ½ do thay Ä‘á»•i

Äiá»u nÃ y mang láº¡i cáº£i thiá»‡n hiá»‡u suáº¥t **Ä‘Ã¡ng ká»ƒ** cho cÃ¡c Ä‘á»‘i tÆ°á»£ng vÃ  máº£ng lá»“ng sÃ¢u vÃ¬ Vue khÃ´ng cáº§n theo dÃµi tá»«ng thuá»™c tÃ­nh/máº£ng Ä‘Æ¡n láº» Ä‘á»ƒ sá»­a Ä‘á»•i. Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, `data` cÅ©ng nÃªn lÃ  immutable.

#### BÆ°á»›c di chuyá»ƒn

Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, khÃ´ng cáº§n bÆ°á»›c di chuyá»ƒn nÃ o, nhÆ°ng náº¿u báº¡n dá»±a vÃ o reactivity cá»§a Ä‘á»‘i tÆ°á»£ng data thÃ¬ báº¡n cÃ³ hai tÃ¹y chá»n:

1. Báº¡n cÃ³ thá»ƒ chi tiáº¿t opt in vÃ o deep reactivity trÃªn cÆ¡ sá»Ÿ tá»«ng composable:
   ```diff
   - const { data } = useFetch('/api/test')
   + const { data } = useFetch('/api/test', { deep: true })
   ```
2. Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i hÃ nh vi máº·c Ä‘á»‹nh trÃªn cÆ¡ sá»Ÿ toÃ n dá»± Ã¡n (khÃ´ng Ä‘Æ°á»£c khuyáº¿n nghá»‹):
   ```ts twoslash [nuxt.config.ts]
   export default defineNuxtConfig({
     experimental: {
       defaults: {
         useAsyncData: {
           deep: true
         }
       }
     }
   })
   ```

::tip
Náº¿u cáº§n, báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng hÃ³a bÆ°á»›c nÃ y báº±ng cÃ¡ch cháº¡y `npx codemod@latest nuxt/4/shallow-function-reactivity`
::

### ÄÆ°á»ng dáº«n Watch tuyá»‡t Ä‘á»‘i trong `builder:watch`

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

Hook `builder:watch` cá»§a Nuxt giá» Ä‘Ã¢y emit má»™t path tuyá»‡t Ä‘á»‘i thay vÃ¬ tÆ°Æ¡ng Ä‘á»‘i so vá»›i `srcDir` dá»± Ã¡n cá»§a báº¡n.

#### LÃ½ do thay Ä‘á»•i

Äiá»u nÃ y cho phÃ©p chÃºng tÃ´i há»— trá»£ theo dÃµi cÃ¡c paths bÃªn ngoÃ i `srcDir` cá»§a báº¡n, vÃ  cung cáº¥p há»— trá»£ tá»‘t hÆ¡n cho layers vÃ  cÃ¡c máº«u phá»©c táº¡p khÃ¡c.

#### BÆ°á»›c di chuyá»ƒn

ChÃºng tÃ´i Ä‘Ã£ chá»§ Ä‘á»™ng di chuyá»ƒn cÃ¡c modules Nuxt cÃ´ng khai mÃ  chÃºng tÃ´i biáº¿t sá»­ dá»¥ng hook nÃ y. Xem [issue #25339](https://github.com/nuxt/nuxt/issues/25339).

Tuy nhiÃªn, náº¿u báº¡n lÃ  tÃ¡c giáº£ module sá»­ dá»¥ng hook `builder:watch` vÃ  muá»‘n duy trÃ¬ kháº£ nÄƒng tÆ°Æ¡ng thÃ­ch ngÆ°á»£c/tiáº¿n, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng mÃ£ sau Ä‘á»ƒ Ä‘áº£m báº£o mÃ£ cá»§a báº¡n hoáº¡t Ä‘á»™ng giá»‘ng nhau trong cáº£ Nuxt v3 vÃ  Nuxt v4:

```diff
+ import { relative, resolve } from 'node:fs'
  // ...
  nuxt.hook('builder:watch', async (event, path) => {
+   path = relative(nuxt.options.srcDir, resolve(nuxt.options.srcDir, path))
    // ...
  })
```

::tip
Báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng hÃ³a bÆ°á»›c nÃ y báº±ng cÃ¡ch cháº¡y `npx codemod@latest nuxt/4/absolute-watch-path`
::

### Loáº¡i bá» Ä‘á»‘i tÆ°á»£ng `window.__NUXT__`

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

ChÃºng tÃ´i Ä‘ang loáº¡i bá» Ä‘á»‘i tÆ°á»£ng toÃ n cá»¥c `window.__NUXT__` sau khi á»©ng dá»¥ng hoÃ n thÃ nh hydration.

#### LÃ½ do thay Ä‘á»•i

Äiá»u nÃ y má»Ÿ Ä‘Æ°á»ng cho cÃ¡c máº«u multi-app ([#21635](https://github.com/nuxt/nuxt/issues/21635)) vÃ  cho phÃ©p chÃºng tÃ´i táº­p trung vÃ o má»™t cÃ¡ch duy nháº¥t Ä‘á»ƒ truy cáº­p dá»¯ liá»‡u Nuxt app - `useNuxtApp()`.

#### BÆ°á»›c di chuyá»ƒn

Dá»¯ liá»‡u váº«n cÃ³ sáºµn, nhÆ°ng cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p vá»›i `useNuxtApp().payload`:

```diff
- console.log(window.__NUXT__)
+ console.log(useNuxtApp().payload)
```

### QuÃ©t index thÆ° má»¥c

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Trung bÃ¬nh

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

CÃ¡c thÆ° má»¥c con trong thÆ° má»¥c `middleware/` cá»§a báº¡n cÅ©ng Ä‘Æ°á»£c quÃ©t Ä‘á»ƒ tÃ¬m cÃ¡c tá»‡p `index` vÃ  chÃºng giá» Ä‘Ã¢y cÅ©ng Ä‘Æ°á»£c Ä‘Äƒng kÃ½ lÃ m middleware trong dá»± Ã¡n cá»§a báº¡n.

#### LÃ½ do thay Ä‘á»•i

Nuxt tá»± Ä‘á»™ng quÃ©t má»™t sá»‘ thÆ° má»¥c, bao gá»“m `middleware/` vÃ  `plugins/`.

CÃ¡c thÆ° má»¥c con trong thÆ° má»¥c `plugins/` cá»§a báº¡n Ä‘Æ°á»£c quÃ©t Ä‘á»ƒ tÃ¬m cÃ¡c tá»‡p `index` vÃ  chÃºng tÃ´i muá»‘n lÃ m cho hÃ nh vi nÃ y nháº¥t quÃ¡n giá»¯a cÃ¡c thÆ° má»¥c Ä‘Æ°á»£c quÃ©t.

#### BÆ°á»›c di chuyá»ƒn

CÃ³ láº½ khÃ´ng cáº§n di chuyá»ƒn gÃ¬ nhÆ°ng náº¿u báº¡n muá»‘n hoÃ n nguyÃªn vá» hÃ nh vi trÆ°á»›c Ä‘Ã¢y, báº¡n cÃ³ thá»ƒ thÃªm má»™t hook Ä‘á»ƒ lá»c ra nhá»¯ng middleware nÃ y:

```ts
export default defineNuxtConfig({
  hooks: {
    'app:resolve'(app) {
      app.middleware = app.middleware.filter(mw => !/\/index\.[^/]+$/.test(mw.path))
    }
  }
})
```

### Thay Ä‘á»•i Template Compilation

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

TrÆ°á»›c Ä‘Ã¢y, Nuxt sá»­ dá»¥ng `lodash/template` Ä‘á»ƒ biÃªn dá»‹ch cÃ¡c templates náº±m trÃªn há»‡ thá»‘ng tá»‡p báº±ng Ä‘á»‹nh dáº¡ng/cÃº phÃ¡p tá»‡p `.ejs`.

NgoÃ i ra, chÃºng tÃ´i cung cáº¥p má»™t sá»‘ utilities template (`serialize`, `importName`, `importSources`) cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o mÃ£ trong nhá»¯ng templates nÃ y, giá» Ä‘Ã¢y Ä‘ang Ä‘Æ°á»£c loáº¡i bá».

#### LÃ½ do thay Ä‘á»•i

Trong Nuxt v3 chÃºng tÃ´i chuyá»ƒn sang cÃº phÃ¡p 'áº£o' vá»›i hÃ m `getContents()` linh hoáº¡t vÃ  hiá»‡u suáº¥t hÆ¡n nhiá»u.

NgoÃ i ra, `lodash/template` Ä‘Ã£ cÃ³ má»™t loáº¡t cÃ¡c váº¥n Ä‘á» báº£o máº­t. Nhá»¯ng váº¥n Ä‘á» nÃ y khÃ´ng thá»±c sá»± Ã¡p dá»¥ng cho cÃ¡c dá»± Ã¡n Nuxt vÃ¬ nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng táº¡i thá»i Ä‘iá»ƒm build, khÃ´ng pháº£i runtime, vÃ  bá»Ÿi mÃ£ Ä‘Ã¡ng tin cáº­y. Tuy nhiÃªn, chÃºng váº«n xuáº¥t hiá»‡n trong cÃ¡c kiá»ƒm tra báº£o máº­t. HÆ¡n ná»¯a, `lodash` lÃ  má»™t dependency náº·ng vÃ  khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi háº§u háº¿t cÃ¡c dá»± Ã¡n.

Cuá»‘i cÃ¹ng, viá»‡c cung cáº¥p cÃ¡c hÃ m serialization mÃ£ trá»±c tiáº¿p trong Nuxt lÃ  khÃ´ng lÃ½ tÆ°á»Ÿng. Thay vÃ o Ä‘Ã³, chÃºng tÃ´i duy trÃ¬ cÃ¡c dá»± Ã¡n nhÆ° [unjs/knitwork](http://github.com/unjs/knitwork) cÃ³ thá»ƒ lÃ  dependencies cá»§a dá»± Ã¡n báº¡n, vÃ  nÆ¡i cÃ¡c váº¥n Ä‘á» báº£o máº­t cÃ³ thá»ƒ Ä‘Æ°á»£c bÃ¡o cÃ¡o/giáº£i quyáº¿t trá»±c tiáº¿p mÃ  khÃ´ng yÃªu cáº§u nÃ¢ng cáº¥p Nuxt.

#### BÆ°á»›c di chuyá»ƒn

ChÃºng tÃ´i Ä‘Ã£ táº¡o cÃ¡c PR Ä‘á»ƒ cáº­p nháº­t cÃ¡c modules sá»­ dá»¥ng cÃº phÃ¡p EJS, nhÆ°ng náº¿u báº¡n cáº§n tá»± lÃ m Ä‘iá»u nÃ y, báº¡n cÃ³ ba lá»±a chá»n tÆ°Æ¡ng thÃ­ch ngÆ°á»£c/tiáº¿n:

* Di chuyá»ƒn logic string interpolation cá»§a báº¡n trá»±c tiáº¿p vÃ o `getContents()`.
* Sá»­ dá»¥ng hÃ m tÃ¹y chá»‰nh Ä‘á»ƒ xá»­ lÃ½ viá»‡c thay tháº¿, nhÆ° trong https://github.com/nuxt-modules/color-mode/pull/240.
* Sá»­ dá»¥ng `es-toolkit/compat` (thay tháº¿ drop-in cho lodash template), nhÆ° má»™t dependency cá»§a dá»± Ã¡n _báº¡n_ thay vÃ¬ Nuxt:

```diff
+ import { readFileSync } from 'node:fs'
+ import { template } from 'es-toolkit/compat'
  // ...
  addTemplate({
    fileName: 'appinsights-vue.js'
    options: { /* some options */ },
-   src: resolver.resolve('./runtime/plugin.ejs'),
+   getContents({ options }) {
+     const contents = readFileSync(resolver.resolve('./runtime/plugin.ejs'), 'utf-8')
+     return template(contents)({ options })
+   },
  })
```

Cuá»‘i cÃ¹ng, náº¿u báº¡n Ä‘ang sá»­ dá»¥ng cÃ¡c template utilities (`serialize`, `importName`, `importSources`), báº¡n cÃ³ thá»ƒ thay tháº¿ chÃºng nhÆ° sau vá»›i cÃ¡c utilities tá»« `knitwork`:

```ts
import { genDynamicImport, genImport, genSafeVariableName } from 'knitwork'

const serialize = (data: any) => JSON.stringify(data, null, 2).replace(/"{(.+)}"(?=,?$)/gm, r => JSON.parse(r).replace(/^{(.*)}$/, '$1'))

const importSources = (sources: string | string[], { lazy = false } = {}) => {
  return toArray(sources).map((src) => {
    if (lazy) {
      return `const ${genSafeVariableName(src)} = ${genDynamicImport(src, { comment: `webpackChunkName: ${JSON.stringify(src)}` })}`
    }
    return genImport(src, genSafeVariableName(src))
  }).join('\n')
}

const importName = genSafeVariableName
```

::tip
Báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng hÃ³a bÆ°á»›c nÃ y báº±ng cÃ¡ch cháº¡y `npx codemod@latest nuxt/4/template-compilation-changes`
::

### Thay Ä‘á»•i cáº¥u hÃ¬nh TypeScript máº·c Ä‘á»‹nh

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### Nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i

`compilerOptions.noUncheckedIndexedAccess` giá» Ä‘Ã¢y lÃ  `true` thay vÃ¬ `false`.

#### LÃ½ do thay Ä‘á»•i

Thay Ä‘á»•i nÃ y lÃ  pháº§n tiáº¿p theo cá»§a [cáº­p nháº­t cáº¥u hÃ¬nh 3.12](https://github.com/nuxt/nuxt/pull/27485) trÆ°á»›c Ä‘Ã¢y khi chÃºng tÃ´i cáº£i thiá»‡n cÃ¡c máº·c Ä‘á»‹nh cá»§a mÃ¬nh, chá»§ yáº¿u tuÃ¢n thá»§ [khuyáº¿n nghá»‹ cá»§a TotalTypeScript](https://www.totaltypescript.com/tsconfig-cheat-sheet).

#### BÆ°á»›c di chuyá»ƒn

CÃ³ hai cÃ¡ch tiáº¿p cáº­n:

1. Cháº¡y typecheck trÃªn á»©ng dá»¥ng cá»§a báº¡n vÃ  sá»­a báº¥t ká»³ lá»—i má»›i nÃ o (Ä‘Æ°á»£c khuyáº¿n nghá»‹).

2. Ghi Ä‘Ã¨ máº·c Ä‘á»‹nh má»›i trong `nuxt.config.ts` cá»§a báº¡n:

   <!-- @case-police-ignore tsConfig -->

   ```ts
   export default defineNuxtConfig({
     typescript: {
       tsConfig: {
         compilerOptions: {
           noUncheckedIndexedAccess: false
         }
       }
     }
   })
   ```

### Chia tÃ¡ch cáº¥u hÃ¬nh TypeScript

ğŸš¦ **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng**: Tá»‘i thiá»ƒu

#### What Changed

Nuxt hiá»‡n táº¡i táº¡o ra cÃ¡c cáº¥u hÃ¬nh TypeScript riÃªng biá»‡t cho cÃ¡c ngá»¯ cáº£nh khÃ¡c nhau Ä‘á»ƒ cung cáº¥p tráº£i nghiá»‡m kiá»ƒm tra kiá»ƒu tá»‘t hÆ¡n:

1. **CÃ¡c file cáº¥u hÃ¬nh TypeScript má»›i**: Nuxt hiá»‡n táº¡i táº¡o ra cÃ¡c cáº¥u hÃ¬nh TypeScript bá»• sung:
   * `.nuxt/tsconfig.app.json` - Cho mÃ£ á»©ng dá»¥ng cá»§a báº¡n (cÃ¡c component Vue, composables, v.v.)
   * `.nuxt/tsconfig.server.json` - Cho mÃ£ phÃ­a server cá»§a báº¡n (thÆ° má»¥c Nitro/server)  
   * `.nuxt/tsconfig.node.json` - Cho mÃ£ build-time cá»§a báº¡n (modules, `nuxt.config.ts`, v.v.)
   * `.nuxt/tsconfig.shared.json` - Cho mÃ£ Ä‘Æ°á»£c chia sáº» giá»¯a ngá»¯ cáº£nh app vÃ  server (nhÆ° types vÃ  cÃ¡c tiá»‡n Ã­ch khÃ´ng phá»¥ thuá»™c mÃ´i trÆ°á»ng)
   * `.nuxt/tsconfig.json` - Cáº¥u hÃ¬nh legacy Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch ngÆ°á»£c

2. **TÆ°Æ¡ng thÃ­ch ngÆ°á»£c**: CÃ¡c dá»± Ã¡n hiá»‡n táº¡i má»Ÿ rá»™ng `.nuxt/tsconfig.json` sáº½ tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng nhÆ° trÆ°á»›c.

3. **Opt-in project references**: CÃ¡c dá»± Ã¡n má»›i hoáº·c nhá»¯ng dá»± Ã¡n muá»‘n kiá»ƒm tra kiá»ƒu tá»‘t hÆ¡n cÃ³ thá»ƒ Ã¡p dá»¥ng tÃ­nh nÄƒng project references cá»§a TypeScript.

4. **Kiá»ƒm tra kiá»ƒu theo ngá»¯ cáº£nh cá»¥ thá»ƒ**: Má»—i ngá»¯ cáº£nh hiá»‡n cÃ³ cÃ¡c tÃ¹y chá»n compiler phÃ¹ há»£p vÃ  includes/excludes cho mÃ´i trÆ°á»ng cá»¥ thá»ƒ cá»§a nÃ³.

5. **TÃ¹y chá»n `typescript.nodeTsConfig` má»›i**: Báº¡n hiá»‡n cÃ³ thá»ƒ tÃ¹y chá»‰nh cáº¥u hÃ¬nh TypeScript cho mÃ£ build-time Node.js.

#### Reasons for Change

Thay Ä‘á»•i nÃ y mang láº¡i má»™t sá»‘ lá»£i Ã­ch:

1. **An toÃ n kiá»ƒu tá»‘t hÆ¡n**: Má»—i ngá»¯ cáº£nh (app, server, build-time) Ä‘Æ°á»£c kiá»ƒm tra kiá»ƒu phÃ¹ há»£p vá»›i cÃ¡c globals vÃ  APIs cá»¥ thá»ƒ theo ngá»¯ cáº£nh.
2. **Tráº£i nghiá»‡m IDE Ä‘Æ°á»£c cáº£i thiá»‡n**: IntelliSense vÃ  bÃ¡o lá»—i tá»‘t hÆ¡n cho cÃ¡c pháº§n khÃ¡c nhau cá»§a codebase.
3. **TÃ¡ch biá»‡t rÃµ rÃ ng hÆ¡n**: MÃ£ server sáº½ khÃ´ng Ä‘á» xuáº¥t sai cÃ¡c API phÃ­a client vÃ  ngÆ°á»£c láº¡i.
4. **Hiá»‡u suáº¥t**: TypeScript cÃ³ thá»ƒ kiá»ƒm tra mÃ£ hiá»‡u quáº£ hÆ¡n vá»›i cÃ¡c cáº¥u hÃ¬nh Ä‘Æ°á»£c pháº¡m vi hÃ³a Ä‘Ãºng cÃ¡ch.

VÃ­ dá»¥, auto-imports khÃ´ng kháº£ dá»¥ng trong `nuxt.config.ts` cá»§a báº¡n (nhÆ°ng trÆ°á»›c Ä‘Ã¢y Ä‘iá»u nÃ y khÃ´ng Ä‘Æ°á»£c TypeScript bÃ¡o cá»). VÃ  trong khi IDEs nháº­n ra ngá»¯ cáº£nh riÃªng biá»‡t Ä‘Æ°á»£c gá»£i Ã½ bá»Ÿi `tsconfig.json` trong thÆ° má»¥c `server/` cá»§a báº¡n, Ä‘iá»u nÃ y khÃ´ng Ä‘Æ°á»£c pháº£n Ã¡nh trong kiá»ƒm tra kiá»ƒu (yÃªu cáº§u má»™t bÆ°á»›c riÃªng biá»‡t).

#### Migration Steps

**KhÃ´ng cáº§n migration** - cÃ¡c dá»± Ã¡n hiá»‡n táº¡i sáº½ tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng nhÆ° trÆ°á»›c.

Tuy nhiÃªn, Ä‘á»ƒ táº­n dá»¥ng viá»‡c kiá»ƒm tra kiá»ƒu Ä‘Æ°á»£c cáº£i thiá»‡n, báº¡n cÃ³ thá»ƒ opt-in vÃ o phÆ°Æ¡ng phÃ¡p project references má»›i:

1. **Cáº­p nháº­t `tsconfig.json` gá»‘c cá»§a báº¡n** Ä‘á»ƒ sá»­ dá»¥ng project references:

   ```json
   {
     "files": [],
     "references": [
       { "path": "./.nuxt/tsconfig.app.json" },
       { "path": "./.nuxt/tsconfig.server.json" },
       { "path": "./.nuxt/tsconfig.shared.json" },
       { "path": "./.nuxt/tsconfig.node.json" }
     ]
   }
   ```

2. **XÃ³a báº¥t ká»³ file `tsconfig.json` server thá»§ cÃ´ng** (nhÆ° `server/tsconfig.json`) Ä‘Ã£ má»Ÿ rá»™ng `.nuxt/tsconfig.server.json`.

3. **Cáº­p nháº­t scripts kiá»ƒm tra kiá»ƒu cá»§a báº¡n** Ä‘á»ƒ sá»­ dá»¥ng build flag cho project references:

   ```diff
   - "typecheck": "nuxt prepare && vue-tsc --noEmit"
   + "typecheck": "nuxt prepare && vue-tsc -b --noEmit"
   ```

4. **Di chuyá»ƒn táº¥t cáº£ type augmentations vÃ o ngá»¯ cáº£nh phÃ¹ há»£p**:
   * Náº¿u báº¡n Ä‘ang augment types cho ngá»¯ cáº£nh app, di chuyá»ƒn cÃ¡c file vÃ o thÆ° má»¥c `app/`.
   * Náº¿u báº¡n Ä‘ang augment types cho ngá»¯ cáº£nh server, di chuyá»ƒn cÃ¡c file vÃ o thÆ° má»¥c `server/`.
   * Náº¿u báº¡n Ä‘ang augment types Ä‘Æ°á»£c **chia sáº» giá»¯a app vÃ  server**, di chuyá»ƒn cÃ¡c file vÃ o thÆ° má»¥c `shared/`.

    ::warning
    Augmenting types tá»« bÃªn ngoÃ i thÆ° má»¥c `app/`, `server/`, hoáº·c `shared/` sáº½ khÃ´ng hoáº¡t Ä‘á»™ng vá»›i thiáº¿t láº­p project references má»›i.
    ::

5. **Cáº¥u hÃ¬nh tÃ¹y chá»n Node.js TypeScript** náº¿u cáº§n:
   <!-- @case-police-ignore tsConfig -->

   ```ts
   export default defineNuxtConfig({
     typescript: {
       // TÃ¹y chá»‰nh cáº¥u hÃ¬nh TypeScript cho app/server
       tsConfig: {
         compilerOptions: {
           strict: true
         }
       },
       // TÃ¹y chá»‰nh cáº¥u hÃ¬nh TypeScript cho build-time  
       nodeTsConfig: {
         compilerOptions: {
           strict: true
         }
       }
     }
   })
   ```

6. **Cáº­p nháº­t báº¥t ká»³ CI/build scripts** cháº¡y kiá»ƒm tra TypeScript Ä‘á»ƒ Ä‘áº£m báº£o chÃºng sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p project references má»›i.

Cáº¥u hÃ¬nh má»›i cung cáº¥p an toÃ n kiá»ƒu vÃ  IntelliSense tá»‘t hÆ¡n cho cÃ¡c dá»± Ã¡n opt-in, Ä‘á»“ng thá»i duy trÃ¬ tÆ°Æ¡ng thÃ­ch ngÆ°á»£c Ä‘áº§y Ä‘á»§ cho cÃ¡c thiáº¿t láº­p hiá»‡n táº¡i.

### Removal of Experimental Features

ğŸš¦ **Impact Level**: Tá»‘i thiá»ƒu

#### What Changed

Bá»‘n tÃ­nh nÄƒng thá»­ nghiá»‡m khÃ´ng cÃ²n cÃ³ thá»ƒ cáº¥u hÃ¬nh trong Nuxt 4:

* `experimental.treeshakeClientOnly` sáº½ lÃ  `true` (máº·c Ä‘á»‹nh tá»« v3.0)
* `experimental.configSchema` sáº½ lÃ  `true` (máº·c Ä‘á»‹nh tá»« v3.3)
* `experimental.polyfillVueUseHead` sáº½ lÃ  `false` (máº·c Ä‘á»‹nh tá»« v3.4)
* `experimental.respectNoSSRHeader` sáº½ lÃ  `false` (máº·c Ä‘á»‹nh tá»« v3.4)
* `vite.devBundler` khÃ´ng cÃ²n cÃ³ thá»ƒ cáº¥u hÃ¬nh - nÃ³ sáº½ sá»­ dá»¥ng `vite-node` theo máº·c Ä‘á»‹nh

#### Reasons for Change

CÃ¡c tÃ¹y chá»n nÃ y Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t thÃ nh giÃ¡ trá»‹ hiá»‡n táº¡i trong má»™t thá»i gian vÃ  chÃºng tÃ´i khÃ´ng cÃ³ lÃ½ do Ä‘á»ƒ tin ráº±ng chÃºng cáº§n pháº£i váº«n cÃ³ thá»ƒ cáº¥u hÃ¬nh.

#### Migration Steps

* `polyfillVueUseHead` cÃ³ thá»ƒ Ä‘Æ°á»£c triá»ƒn khai trong user-land vá»›i [plugin nÃ y](https://github.com/nuxt/nuxt/blob/f209158352b09d1986aa320e29ff36353b91c358/packages/nuxt/src/head/runtime/plugins/vueuse-head-polyfill.ts#L10-L11)

* `respectNoSSRHeader` cÃ³ thá»ƒ Ä‘Æ°á»£c triá»ƒn khai trong user-land vá»›i [server middleware](https://github.com/nuxt/nuxt/blob/c660b39447f0d5b8790c0826092638d321cd6821/packages/nuxt/src/core/runtime/nitro/no-ssr.ts#L8-L9)

### Removal of Top-Level `generate` Configuration

ğŸš¦ **Impact Level**: Tá»‘i thiá»ƒu

#### What Changed

TÃ¹y chá»n cáº¥u hÃ¬nh `generate` cáº¥p cao nháº¥t khÃ´ng cÃ²n kháº£ dá»¥ng trong Nuxt 4. Äiá»u nÃ y bao gá»“m táº¥t cáº£ cÃ¡c thuá»™c tÃ­nh cá»§a nÃ³:

* `generate.exclude` - Ä‘á»ƒ loáº¡i trá»« cÃ¡c routes khá»i prerendering
* `generate.routes` - Ä‘á»ƒ chá»‰ Ä‘á»‹nh cÃ¡c routes cáº§n prerender

#### Reasons for Change

Cáº¥u hÃ¬nh `generate` cáº¥p cao lÃ  di sáº£n tá»« Nuxt 2. ChÃºng tÃ´i Ä‘Ã£ há»— trá»£ `nitro.prerender` trong má»™t thá»i gian vÃ  Ä‘Ã³ lÃ  cÃ¡ch Æ°a thÃ­ch Ä‘á»ƒ cáº¥u hÃ¬nh prerendering trong Nuxt 3+.

#### Migration Steps

Thay tháº¿ cáº¥u hÃ¬nh `generate` báº±ng cÃ¡c tÃ¹y chá»n `nitro.prerender` tÆ°Æ¡ng á»©ng:

```diff
export default defineNuxtConfig({
- generate: {
-   exclude: ['/admin', '/private'],
-   routes: ['/sitemap.xml', '/robots.txt']
- }
+ nitro: {
+   prerender: {
+     ignore: ['/admin', '/private'],
+     routes: ['/sitemap.xml', '/robots.txt']
+   }
+ }
})
```

::read-more{to="https://nitro.build/config#prerender"}
Äá»c thÃªm vá» cÃ¡c tÃ¹y chá»n cáº¥u hÃ¬nh prerender cá»§a Nitro.
::

## Nuxt 2 vs. Nuxt 3+

Trong báº£ng dÆ°á»›i Ä‘Ã¢y, cÃ³ má»™t so sÃ¡nh nhanh giá»¯a 3 phiÃªn báº£n cá»§a Nuxt:

Feature / Version        | Nuxt 2          | Nuxt Bridge      | Nuxt 3+
-------------------------|-----------------|------------------|---------
Vue                      | 2               | 2                | 3
Stability                | ğŸ˜Š á»”n Ä‘á»‹nh      | ğŸ˜Š á»”n Ä‘á»‹nh         | ğŸ˜Š á»”n Ä‘á»‹nh
Performance              | ğŸ Nhanh        | âœˆï¸ Nhanh hÆ¡n          | ğŸš€ Nhanh nháº¥t
Nitro Engine             | âŒ             | âœ…                | âœ…
ESM support              | ğŸŒ™ Má»™t pháº§n     | ğŸ‘ Tá»‘t hÆ¡n         | âœ…
TypeScript               | â˜‘ï¸ Opt-in       | ğŸš§ Má»™t pháº§n        | âœ…
Composition API          | âŒ             | ğŸš§ Má»™t pháº§n        | âœ…
Options API              | âœ…             | âœ…                | âœ…
Components Auto Import   | âœ…             | âœ…                | âœ…
`<script setup>` syntax  | âŒ             | ğŸš§ Má»™t pháº§n        | âœ…
Auto Imports             | âŒ             | âœ…                | âœ…
webpack                  | 4              | 4                 | 5
Vite                     | âš ï¸ Má»™t pháº§n      | ğŸš§ Má»™t pháº§n        | âœ…
Nuxt CLI                 | âŒ CÅ©         | âœ… nuxt           | âœ… nuxt
Static sites             | âœ…             | âœ…                | âœ…

## Nuxt 2 to Nuxt 3+

HÆ°á»›ng dáº«n migration cung cáº¥p so sÃ¡nh tá»«ng bÆ°á»›c cÃ¡c tÃ­nh nÄƒng cá»§a Nuxt 2 vá»›i cÃ¡c tÃ­nh nÄƒng Nuxt 3+ vÃ  hÆ°á»›ng dáº«n Ä‘á»ƒ thÃ­ch á»©ng á»©ng dá»¥ng hiá»‡n táº¡i cá»§a báº¡n.

::read-more{to="/docs/migration/overview"}
Kiá»ƒm tra **hÆ°á»›ng dáº«n migration tá»« Nuxt 2 sang Nuxt 3**.
::

## Nuxt 2 to Nuxt Bridge

Náº¿u báº¡n muá»‘n tá»« tá»« migration á»©ng dá»¥ng Nuxt 2 cá»§a mÃ¬nh sang Nuxt 3, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng Nuxt Bridge. Nuxt Bridge lÃ  má»™t lá»›p tÆ°Æ¡ng thÃ­ch cho phÃ©p báº¡n sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng Nuxt 3+ trong Nuxt 2 vá»›i cÆ¡ cháº¿ opt-in.

::read-more{to="/docs/bridge/overview"}
**Migration tá»« Nuxt 2 sang Nuxt Bridge**
::