---
title: "plugins"
description: "Nuxt has a plugins system to use Vue plugins and more at the creation of your Vue application."
head.title: "plugins/"
navigation.icon: i-lucide-folder
---

Nuxt tự động đọc các files trong thư mục `plugins/` và load chúng khi tạo ứng dụng Vue.

::note
Tất cả plugins bên trong được tự động đăng ký, bạn không cần thêm chúng vào `nuxt.config` riêng biệt.
::

::note
Bạn có thể sử dụng suffix `.server` hoặc `.client` trong tên file để load plugin chỉ trên server hoặc client side.
::

## Registered Plugins

Chỉ có files ở top level của thư mục (hoặc index files trong bất kỳ subdirectories nào) sẽ được tự động đăng ký như plugins.

```bash [Directory structure]
-| plugins/
---| foo.ts      // scanned
---| bar/
-----| baz.ts    // not scanned
-----| foz.vue   // not scanned
-----| index.ts  // currently scanned but deprecated
```

Chỉ có `foo.ts` và `bar/index.ts` sẽ được đăng ký.

Để thêm plugins trong subdirectories, bạn có thể sử dụng option [`plugins`](/docs/api/nuxt-config#plugins-1) trong `nuxt.config.ts`:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  plugins: [
    '~/plugins/bar/baz',
    '~/plugins/bar/foz'
  ]
})
```

## Creating Plugins

Đối số duy nhất được truyền cho plugin là [`nuxtApp`](/docs/api/composables/use-nuxt-app).

```ts twoslash [plugins/hello.ts]
export default defineNuxtPlugin(nuxtApp => {
  // Doing something with nuxtApp
})
```

### Object Syntax Plugins

Cũng có thể định nghĩa plugin bằng object syntax, cho các use cases nâng cao hơn. Ví dụ:

```ts twoslash [plugins/hello.ts]
export default defineNuxtPlugin({
  name: 'my-plugin',
  enforce: 'pre', // or 'post'
  async setup (nuxtApp) {
    // this is the equivalent of a normal functional plugin
  },
  hooks: {
    // You can directly register Nuxt app runtime hooks here
    'app:created'() {
      const nuxtApp = useNuxtApp()
      // do something in the hook
    }
  },
  env: {
    // Set this value to `false` if you don't want the plugin to run when rendering server-only or island components.
    islands: true
  }
})
```

:video-accordion{title="Watch a video from Alexander Lichter about the Object Syntax for Nuxt plugins" videoId="2aXZyXB1QGQ"}

::note
Nếu bạn đang sử dụng object-syntax, các properties được statically analyzed để tạo ra build được tối ưu hóa hơn. Vì vậy bạn không nên định nghĩa chúng tại runtime. :br
Ví dụ, đặt `enforce: import.meta.server ? 'pre' : 'post'` sẽ làm mất bất kỳ tối ưu hóa nào mà Nuxt có thể làm cho plugins của bạn.
Nuxt does statically pre-load any hook listeners when using object-syntax, allowing you to define hooks without needing to worry about order of plugin registration.
::

## Registration Order

Bạn có thể kiểm soát thứ tự mà plugins được đăng ký bằng cách thêm tiền tố 'alphabetical' numbering vào tên files.

```bash [Directory structure]
plugins/
 | - 01.myPlugin.ts
 | - 02.myOtherPlugin.ts
```

Trong ví dụ này, `02.myOtherPlugin.ts` sẽ có thể truy cập bất cứ thứ gì được inject bởi `01.myPlugin.ts`.

Điều này hữu ích trong các tình huống mà bạn có plugin phụ thuộc vào plugin khác.

::note
Trong trường hợp bạn mới với 'alphabetical' numbering, hãy nhớ rằng tên files được sắp xếp như strings, không phải như giá trị số. Ví dụ, `10.myPlugin.ts` sẽ đến trước `2.myOtherPlugin.ts`. Đây là lý do ví dụ thêm `0` trước số có một chữ số.
::

## Loading Strategy

### Parallel Plugins

Theo mặc định, Nuxt load plugins sequentially. Bạn có thể định nghĩa plugin là `parallel` nên Nuxt sẽ không chờ đến cuối việc thực thi plugin trước khi load plugin tiếp theo.

```ts twoslash [plugins/my-plugin.ts]
export default defineNuxtPlugin({
  name: 'my-plugin',
  parallel: true,
  async setup (nuxtApp) {
    // the next plugin will be executed immediately
  }
})
```

### Plugins With Dependencies

Nếu plugin cần chờ plugin khác trước khi nó chạy, bạn có thể thêm tên plugin vào array `dependsOn`.

```ts twoslash [plugins/depending-on-my-plugin.ts]
export default defineNuxtPlugin({
  name: 'depends-on-my-plugin',
  dependsOn: ['my-plugin'],
  async setup (nuxtApp) {
    // this plugin will wait for the end of `my-plugin`'s execution before it runs
  }
})
```

## Using Composables

Bạn có thể sử dụng [composables](/docs/guide/directory-structure/composables) cũng như [utils](/docs/guide/directory-structure/utils) trong Nuxt plugins:

```ts [plugins/hello.ts]
export default defineNuxtPlugin((nuxtApp) => {
  const foo = useFoo()
})
```

Tuy nhiên, hãy nhớ rằng có một số limitations và differences:

::important
**Nếu composable phụ thuộc vào plugin khác được đăng ký sau, nó có thể không hoạt động.** :br

Plugins được gọi theo thứ tự sequentially và trước mọi thứ khác. Bạn có thể sử dụng composable phụ thuộc vào plugin khác chưa được gọi.
::

::important
**Nếu composable phụ thuộc vào Vue.js lifecycle, nó sẽ không hoạt động.** :br

Normally, Vue.js composables are bound to the current component instance while plugins are only bound to [`nuxtApp`](/docs/api/composables/use-nuxt-app) instance.
::

## Providing Helpers

Nếu bạn muốn provide helper trên instance [`NuxtApp`](/docs/api/composables/use-nuxt-app), return nó từ plugin dưới key `provide`.

::code-group
```ts twoslash [plugins/hello.ts]
export default defineNuxtPlugin(() => {
  return {
    provide: {
      hello: (msg: string) => `Hello ${msg}!`
    }
  }
})
```
```ts twoslash [plugins/hello-object-syntax.ts]
export default defineNuxtPlugin({
  name: 'hello',
  setup () {
    return {
      provide: {
        hello: (msg: string) => `Hello ${msg}!`
      }
    }
  }
})
```
::

Sau đó bạn có thể sử dụng helper trong components của mình:

```vue [components/Hello.vue]
<script setup lang="ts">
// alternatively, you can also use it here
const { $hello } = useNuxtApp()
</script>

<template>
  <div>
    {{ $hello('world') }}
  </div>
</template>
```

::important
Lưu ý rằng chúng tôi highly recommend sử dụng [`composables`](/docs/guide/directory-structure/composables) thay vì providing helpers để tránh polluting global namespace và giữ main bundle entry nhỏ.
::

::warning
**Nếu plugin của bạn provide `ref` hoặc `computed`, nó sẽ không được unwrapped trong component `<template>`.** :br
Điều này là do cách Vue hoạt động với refs không phải top-level của template. Bạn có thể đọc thêm về nó [trong Vue documentation](https://vuejs.org/guide/essentials/reactivity-fundamentals.html#caveat-when-unwrapping-in-templates).
::

## Typing Plugins

Nếu bạn return helpers từ plugin, chúng sẽ được typed tự động; bạn sẽ tìm thấy chúng được typed cho return của `useNuxtApp()` và trong templates của bạn.

::note
Nếu bạn cần sử dụng provided helper _trong_ plugin khác, bạn có thể gọi [`useNuxtApp()`](/docs/api/composables/use-nuxt-app) để lấy version được typed. Nhưng nói chung, điều này nên được tránh trừ khi bạn chắc chắn về thứ tự của plugins.
::

Cho advanced use-cases, bạn có thể declare type của injected properties như này:

```ts [index.d.ts]
declare module '#app' {
  interface NuxtApp {
    $hello (msg: string): string
  }
}

declare module 'vue' {
  interface ComponentCustomProperties {
    $hello (msg: string): string
  }
}

export {}
```

::note
Nếu bạn đang sử dụng WebStorm, bạn có thể cần augment `@vue/runtime-core` cho đến khi [issue này](https://youtrack.jetbrains.com/issue/WEB-59818/VUE-TypeScript-WS-PS-does-not-correctly-display-type-of-globally-injected-properties) được resolved.
::

## Vue Plugins

Nếu bạn muốn sử dụng Vue plugins, như [vue-gtag](https://github.com/MatteoGabriele/vue-gtag) để thêm Google Analytics tags, bạn có thể sử dụng Nuxt plugin để làm điều đó.

Đầu tiên, install Vue plugin dependency:

::code-group{sync="pm"}
```bash [npm]
npm install --save-dev vue-gtag-next
```
```bash [yarn]
yarn add --dev vue-gtag-next
```
```bash [pnpm]
pnpm add -D vue-gtag-next
```
```bash [bun]
bun add -D vue-gtag-next
```
::

Sau đó tạo plugin file:

```ts [plugins/vue-gtag.client.ts]
import VueGtag, { trackRouter } from 'vue-gtag-next'

export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.use(VueGtag, {
    property: {
      id: 'GA_MEASUREMENT_ID'
    }
  })
  trackRouter(useRouter())
})
```

## Vue Directives

Tương tự, bạn có thể đăng ký custom Vue directive trong plugin.

```ts twoslash [plugins/my-directive.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.directive('focus', {
    mounted (el) {
      el.focus()
    },
    getSSRProps (binding, vnode) {
      // you can provide SSR-specific props here
      return {}
    }
  })
})
```

::warning
Nếu bạn đăng ký Vue directive, bạn _phải_ đăng ký nó trên cả client và server side trừ khi bạn chỉ sử dụng nó khi rendering một side. Nếu directive chỉ có ý nghĩa từ client side, bạn luôn có thể move nó đến `~/plugins/my-directive.client.ts` và provide 'stub' directive cho server trong `~/plugins/my-directive.server.ts`.
::

:read-more{icon="i-simple-icons-vuedotjs" title="Custom Directives on Vue Docs" to="https://vuejs.org/guide/reusability/custom-directives.html" target="_blank"}
